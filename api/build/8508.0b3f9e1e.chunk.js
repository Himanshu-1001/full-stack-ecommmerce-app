"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[8508],{18508:(k,w,s)=>{s.r(w),s.d(w,{ProfilePage:()=>oe});var e=s(19968),d=s(62552),A=s(3400),j=s(48112),y=s(28464),T=s(42816),O=s(35676),u=s(5e3),_=s(48936),I=s(63358),S=s(28724),g=s(70996),N=s(62492),q=s(17324),D=s(56104),i=s(16048),ee=s(53305),K=s(14032),b=s(63648),se=s(54223),ae=s(30840),z=s(21424),R=s(14632),Q=s(48632),G=s(69372),te=s(97820),J=s(60056),Z=s(61952),ne=s(82728),Ce=s(54320),we=s(5240),Ae=s(91892),je=s(36196),ye=s(20880),Te=s(70516),Ie=s(18424),Se=s(99568),Re=s(21968),Ue=s(12132),Be=s(85676),We=s(35184),Ke=s(17892),be=s(31212),Qe=s(96556);const re=te.kt().shape(ne.s),oe=()=>{const{changeLocale:a,localeNames:l}=(0,J.M)(),{setUserDisplayName:c}=(0,i.s7)(),{formatMessage:t}=(0,R.c)(),{trackUsage:r}=(0,i.m4)(),f=(0,i.eo)(),{lockApp:o,unlockApp:L}=(0,i.H6)(),{notifyStatus:x}=(0,A.O)(),{currentTheme:F,themes:p,onChangeTheme:h}=(0,J.P)(),{get:Y,put:ce}=(0,i.Qn)();(0,i.G0)();const{isLoading:me,data:v,refetch:ue}=(0,Q.useQuery)("user",async()=>{const{data:n}=await Y("/admin/users/me");return n.data},{onSuccess(){x(t({id:"Settings.profile.form.notify.data.loaded",defaultMessage:"Your profile data has been loaded"}))},onError(){f({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),{isLoading:ge,data:_e}=(0,Q.useQuery)(["providers","isSSOLocked"],async()=>{const{data:{data:n}}=await Y("/admin/providers/isSSOLocked");return n},{enabled:window.strapi.isEE&&window.strapi.features.isEnabled("sso"),onError(){f({type:"warning",message:{id:"Settings.permissions.users.sso.provider.error"}})}}),fe=me||ge,X=(0,Q.useMutation)(async n=>{const{confirmPassword:P,currentTheme:E,...M}=n;let m=M;if((B=>"password"in B)(m)&&m.password===""){const{password:B,currentPassword:W,...$}=m;m=$}const{data:C}=await ce("/admin/users/me",m);return{...C.data,currentTheme:E}},{async onSuccess(n){await ue();const{email:P,firstname:E,lastname:M,username:m,preferedLanguage:U}=n;i.cJ.setUserInfo({email:P,firstname:E,lastname:M,username:m,preferedLanguage:U});const C=n.username||(0,Z.g)(n.firstname??"",n.lastname);c(C),n.preferedLanguage&&a(n.preferedLanguage),h(n.currentTheme),r("didChangeMode",{newMode:n.currentTheme}),f({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}})},async onSettled(){L()}}),{isLoading:pe}=X,he=async(n,{setErrors:P})=>{o();const E=n.username;X.mutate({...n,username:E},{onError(M){const m=M?.response?.data;return m?.data?P(m.data):f({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}})};if(fe||!v)return(0,e.jsxs)(j.G,{"aria-busy":"true",children:[(0,e.jsx)(z.S,{title:t({id:"Settings.profile.form.section.helmet.title",defaultMessage:"User profile"})}),(0,e.jsx)(y.a,{title:t({id:"Settings.profile.form.section.profile.page.title",defaultMessage:"Profile page"})}),(0,e.jsx)(T.S,{children:(0,e.jsx)(i.Wm,{})})]});const Ee=_e?.isSSOLocked??!1,{email:Me,firstname:Pe,lastname:Oe,username:De,preferedLanguage:Le}=v,xe={email:Me,firstname:Pe,lastname:Oe,username:De,preferedLanguage:Le,currentTheme:F,confirmPassword:"",password:""};return(0,e.jsxs)(j.G,{"aria-busy":pe,children:[(0,e.jsx)(z.S,{title:t({id:"Settings.profile.form.section.helmet.title",defaultMessage:"User profile"})}),(0,e.jsx)(se.QJ,{onSubmit:he,initialValues:xe,validateOnChange:!1,validationSchema:re,enableReinitialize:!0,children:({errors:n,values:{email:P,firstname:E,lastname:M,username:m,preferedLanguage:U,currentTheme:C,...B},handleChange:W,isSubmitting:$,dirty:ve})=>(0,e.jsxs)(i.QF,{children:[(0,e.jsx)(y.a,{title:v.username||(0,Z.g)(v.firstname??"",v.lastname),primaryAction:(0,e.jsx)(O.Z,{startIcon:(0,e.jsx)(ee.c,{}),loading:$,type:"submit",disabled:!ve,children:t({id:"global.save",defaultMessage:"Save"})})}),(0,e.jsx)(u.k,{paddingBottom:10,children:(0,e.jsx)(T.S,{children:(0,e.jsxs)(_.C,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsx)(le,{errors:n,onChange:W,values:{firstname:E,lastname:M,username:m,email:P}}),!Ee&&(0,e.jsx)(ie,{errors:n,onChange:W,values:B}),(0,e.jsx)(de,{allApplicationThemes:p,onChange:W,values:{preferedLanguage:U,currentTheme:C},localeNames:l})]})})})]})})]})},ie=({errors:a,onChange:l,values:c})=>{const{formatMessage:t}=(0,R.c)(),[r,f]=d.useState(!1),[o,L]=d.useState(!1),[x,F]=d.useState(!1);return(0,e.jsx)(u.k,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(_.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(I.O,{variant:"delta",as:"h2",children:t({id:"global.change-password",defaultMessage:"Change password"})}),(0,e.jsx)(S.y,{gap:5,children:(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsx)(N.g,{error:a.currentPassword?t({id:a.currentPassword,defaultMessage:a.currentPassword}):"",onChange:l,value:c.currentPassword,label:t({id:"Auth.form.currentPassword.label",defaultMessage:"Current Password"}),name:"currentPassword",type:r?"text":"password",endAction:(0,e.jsx)(H,{onClick:p=>{p.stopPropagation(),f(h=>!h)},label:t(r?{id:"Auth.form.password.show-password",defaultMessage:"Show password"}:{id:"Auth.form.password.hide-password",defaultMessage:"Hide password"}),children:r?(0,e.jsx)(K.c,{}):(0,e.jsx)(b.c,{})})})})}),(0,e.jsxs)(S.y,{gap:5,children:[(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsx)(V,{error:a.password?t({id:a.password,defaultMessage:a.password}):"",onChange:l,value:c.password,label:t({id:"global.password",defaultMessage:"Password"}),name:"password",type:o?"text":"password",autoComplete:"new-password",endAction:(0,e.jsx)(H,{onClick:p=>{p.stopPropagation(),L(h=>!h)},label:t(o?{id:"Auth.form.password.show-password",defaultMessage:"Show password"}:{id:"Auth.form.password.hide-password",defaultMessage:"Hide password"}),children:o?(0,e.jsx)(K.c,{}):(0,e.jsx)(b.c,{})})})}),(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsx)(V,{error:a.confirmPassword?t({id:a.confirmPassword,defaultMessage:a.confirmPassword}):"",onChange:l,value:c.confirmPassword,label:t({id:"Auth.form.confirmPassword.label",defaultMessage:"Confirm Password"}),name:"confirmPassword",type:x?"text":"password",autoComplete:"new-password",endAction:(0,e.jsx)(H,{onClick:p=>{p.stopPropagation(),F(h=>!h)},label:t(x?{id:"Auth.form.password.show-password",defaultMessage:"Show password"}:{id:"Auth.form.password.hide-password",defaultMessage:"Hide password"}),children:x?(0,e.jsx)(K.c,{}):(0,e.jsx)(b.c,{})})})})]})]})})},V=(0,G.cp)(N.g)`
  ::-ms-reveal {
    display: none;
  }
`,H=(0,G.cp)(q.d)`
  svg {
    height: ${(0,i.W8)(16)};
    width: ${(0,i.W8)(16)};
    path {
      fill: ${({theme:a})=>a.colors.neutral600};
    }
  }
`,de=({onChange:a,values:l,localeNames:c,allApplicationThemes:t={}})=>{const{formatMessage:r}=(0,R.c)(),f=Object.keys(t).filter(o=>t[o]);return(0,e.jsx)(u.k,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(_.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsxs)(_.C,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(I.O,{variant:"delta",as:"h2",children:r({id:"Settings.profile.form.section.experience.title",defaultMessage:"Experience"})}),(0,e.jsx)(I.O,{children:r({id:"Settings.profile.form.section.experience.interfaceLanguageHelp",defaultMessage:"Preference changes will apply only to you. More information is available {here}."},{here:(0,e.jsx)(u.k,{as:"a",color:"primary600",target:"_blank",rel:"noopener noreferrer",href:"https://docs.strapi.io/developer-docs/latest/development/admin-customization.html#locales",children:r({id:"Settings.profile.form.section.experience.here",defaultMessage:"here"})})})})]}),(0,e.jsxs)(S.y,{gap:5,children:[(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsx)(D.K_,{label:r({id:"Settings.profile.form.section.experience.interfaceLanguage",defaultMessage:"Interface language"}),placeholder:r({id:"global.select",defaultMessage:"Select"}),hint:r({id:"Settings.profile.form.section.experience.interfaceLanguage.hint",defaultMessage:"This will only display your own interface in the chosen language."}),onClear:()=>{a({target:{name:"preferedLanguage",value:null}})},clearLabel:r({id:"Settings.profile.form.section.experience.clear.select",defaultMessage:"Clear the interface language selected"}),value:l.preferedLanguage,onChange:o=>{a({target:{name:"preferedLanguage",value:o}})},children:Object.entries(c).map(([o,L])=>(0,e.jsx)(D.kH,{value:o,children:L},o))})}),(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsxs)(D.K_,{label:r({id:"Settings.profile.form.section.experience.mode.label",defaultMessage:"Interface mode"}),placeholder:r({id:"components.Select.placeholder",defaultMessage:"Select"}),hint:r({id:"Settings.profile.form.section.experience.mode.hint",defaultMessage:"Displays your interface in the chosen mode."}),value:l.currentTheme,onChange:o=>{a({target:{name:"currentTheme",value:o}})},children:[(0,e.jsx)(D.kH,{value:"system",children:r({id:"Settings.profile.form.section.experience.mode.option-system-label",defaultMessage:"Use system settings"})}),f.map(o=>(0,e.jsx)(D.kH,{value:o,children:r({id:"Settings.profile.form.section.experience.mode.option-label",defaultMessage:"{name} mode"},{name:r({id:o,defaultMessage:ae(o)})})},o))]})})]})]})})},le=({errors:a,onChange:l,values:c})=>{const{formatMessage:t}=(0,R.c)();return(0,e.jsx)(u.k,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(_.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(I.O,{variant:"delta",as:"h2",children:t({id:"global.profile",defaultMessage:"Profile"})}),(0,e.jsxs)(S.y,{gap:5,children:[(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsx)(i.u,{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},error:a.firstname,onChange:l,value:c.firstname,type:"text",name:"firstname",required:!0})}),(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsx)(i.u,{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},error:a.lastname,onChange:l,value:c.lastname,type:"text",name:"lastname"})}),(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsx)(i.u,{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},error:a.email,onChange:l,value:c.email,type:"email",name:"email",required:!0})}),(0,e.jsx)(g.C,{s:12,col:6,children:(0,e.jsx)(i.u,{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},error:a.username,onChange:l,value:c.username,type:"text",name:"username"})})]})]})})}},82728:(k,w,s)=>{s.d(w,{a:()=>T,s:()=>j});var e=s(97820),d=s(16048);const A={firstname:e.Qb().trim().required(d.aO.required),lastname:e.Qb(),email:e.Qb().email(d.aO.email).lowercase().required(d.aO.required),username:e.Qb().nullable(),password:e.Qb().min(8,d.aO.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:e.Qb().min(8,d.aO.minLength).oneOf([e.IL("password"),null],"components.Input.error.password.noMatch").when("password",(O,u)=>O?u.required(d.aO.required):u)},j={...A,currentPassword:e.Qb().when(["password","confirmPassword"],(O,u,_)=>O||u?_.required(d.aO.required):_),preferedLanguage:e.Qb().nullable()},y={roles:e.M$().min(1,d.aO.required).required(d.aO.required)},T=e.kt().shape({...A,isActive:e.SK(),...y})}}]);
