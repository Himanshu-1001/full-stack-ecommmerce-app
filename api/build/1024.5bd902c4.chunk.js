"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[1024],{76232:(B,p,e)=>{e.d(p,{F:()=>C});var s=e(19968),a=e(62552),P=e(5e3),D=e(35676),g=e(16048),L=e(60012),c=e(33104),f=e(14632);const C=({displayedFilters:E})=>{const[T,R]=(0,a.useState)(!1),{formatMessage:A}=(0,f.c)(),U=(0,a.useRef)(),M=()=>{R(j=>!j)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(P.k,{paddingTop:1,paddingBottom:1,children:[(0,s.jsx)(D.Z,{variant:"tertiary",ref:U,startIcon:(0,s.jsx)(L.c,{}),onClick:M,size:"S",children:A({id:"app.utils.filters",defaultMessage:"Filters"})}),T&&(0,s.jsx)(g.SI,{displayedFilters:E,isVisible:T,onToggle:M,source:U})]}),(0,s.jsx)(g.aW,{filtersSchema:E})]})};C.propTypes={displayedFilters:c.arrayOf(c.shape({name:c.string.isRequired,metadatas:c.shape({label:c.string}),fieldSchema:c.shape({type:c.string})})).isRequired}},98644:(B,p,e)=>{e.r(p),e.d(p,{default:()=>me});var s=e(19968),a=e(16048),P=e(70516),D=e(61952),g=e(48936),L=e(63358),c=e(89296),f=e(5e3),C=e(28724),E=e(26852),T=e(11208),R=e(2931),A=e(25824),U=e(48744),M=e(76512),j=e(9752),Z=e(23264),H=e(65092),J=e(9544),X=e(20596),b=e(42816),w=e(48112),k=e(28464),q=e(74432),v=e(14632),ee=e(76232),Q=e(48632),se=e(49008),te=e(74253),ae=e(5848),ne=e(39820),i=e(33104),ie=e(27860),oe=e(14032),Ee=e(62552),ue=e(17892),ge=e(31212),ce=e(60056),pe=e(54320),Me=e(5240),De=e(91892),Oe=e(36196),Pe=e(20880),Le=e(21424),fe=e(54223),ye=e(18424),Ce=e(97820),Te=e(99568),he=e(21968),Re=e(12132),Ae=e(85676),Ue=e(35184),ve=e(96556);const re=({canReadAuditLogs:t,canReadUsers:l})=>{const{get:m}=(0,a.Qn)(),{search:o}=(0,se.IT)(),_=(0,a.eo)(),[{query:d}]=(0,a.WK)(),n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:O=>_({type:"warning",message:O.message})},{users:r,isError:u,isLoading:y}=(0,te.u)({},{...n,enabled:l,staleTime:2*(1e3*60)}),{data:h,isLoading:K,isError:W}=(0,Q.useQuery)(["auditLogs",o],async()=>{const{data:O}=await m("/admin/audit-logs",{params:d});return O},{...n,enabled:t});return{auditLogs:h,users:r,isLoading:y||K,hasError:W||u}},V=()=>{const{formatDate:t}=(0,v.c)();return m=>{const o=(0,ie.c)(m),_=t(o,{dateStyle:"long"}),d=t(o,{timeStyle:"medium",hourCycle:"h24"});return`${_}, ${d}`}},z={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},S=t=>z[t]||t,I=({actionLabel:t,actionName:l})=>(0,s.jsxs)(g.C,{direction:"column",alignItems:"baseline",gap:1,children:[(0,s.jsx)(L.O,{textColor:"neutral600",variant:"sigma",children:t}),(0,s.jsx)(L.O,{textColor:"neutral600",children:l})]});I.propTypes={actionLabel:i.string.isRequired,actionName:i.string.isRequired};const F=({status:t,data:l,formattedDate:m})=>{const{formatMessage:o}=(0,v.c)();if(t==="loading")return(0,s.jsx)(g.C,{padding:7,justifyContent:"center",alignItems:"center",children:(0,s.jsx)(c.c,{children:"Loading content..."})});const{action:_,user:d,payload:n}=l;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.k,{marginBottom:3,children:(0,s.jsx)(L.O,{variant:"delta",id:"title",children:o({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,s.jsxs)(C.y,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,s.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:o({id:`Settings.permissions.auditLogs.${_}`,defaultMessage:S(_)},{model:n?.model})}),(0,s.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:m}),(0,s.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:d?.displayName||"-"}),(0,s.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:d?.id.toString()||"-"})]}),(0,s.jsx)(E.O,{value:JSON.stringify(n,null,2),disabled:!0,label:o({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})};F.defaultProps={data:{}},F.propTypes={status:i.oneOf(["idle","loading","error","success"]).isRequired,data:i.shape({action:i.string,date:i.string,payload:i.object,user:i.object}),formattedDate:i.string.isRequired};const G=({handleClose:t,logId:l})=>{const{get:m}=(0,a.Qn)(),o=(0,a.eo)(),_=async y=>{const{data:h}=await m(`/admin/audit-logs/${y}`);if(!h)throw new Error("Audit log not found");return h},{data:d,status:n}=(0,Q.useQuery)(["audit-log",l],()=>_(l),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),t()}}),r=V(),u=d?r(d.date):"";return(0,s.jsxs)(T.E,{onClose:t,labelledBy:"title",children:[(0,s.jsx)(R.k,{children:(0,s.jsx)(ae.M,{label:u,id:"title",children:(0,s.jsx)(ne.i,{isCurrent:!0,children:u})})}),(0,s.jsx)(A.a,{children:(0,s.jsx)(F,{status:n,data:d,formattedDate:u})})]})};G.propTypes={handleClose:i.func.isRequired,logId:i.string.isRequired};const $=({pagination:t})=>(0,s.jsx)(f.k,{paddingTop:4,children:(0,s.jsxs)(g.C,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,s.jsx)(a.A7,{}),(0,s.jsx)(a.cZ,{pagination:t})]})});$.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},$.propTypes={pagination:i.shape({page:i.number,pageCount:i.number,pageSize:i.number,total:i.number})};const N=({headers:t,rows:l,onOpenModal:m})=>{const{formatMessage:o}=(0,v.c)(),_=V(),d=({type:n,value:r,model:u})=>n==="date"?_(r):n==="action"?o({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:S(r)},{model:u}):r||"-";return(0,s.jsx)(U.K,{children:l.map(n=>(0,s.jsxs)(M.Tr,{...(0,a.on)({fn:()=>m(n.id)}),children:[t.map(({key:r,name:u,cellFormatter:y})=>(0,s.jsx)(j.Td,{children:(0,s.jsx)(L.O,{textColor:"neutral800",children:d({type:r,value:y?y(n[u]):n[u],model:n.payload?.model})})},r)),(0,s.jsx)(j.Td,{...a.Ii,children:(0,s.jsx)(g.C,{justifyContent:"end",children:(0,s.jsx)(Z.w,{onClick:()=>m(n.id),"aria-label":o({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${n.action} action`}),noBorder:!0,icon:(0,s.jsx)(oe.c,{})})})})]},n.id))})};N.defaultProps={rows:[]},N.propTypes={headers:i.array.isRequired,rows:i.array,onOpenModal:i.func.isRequired};const x=({value:t,options:l,onChange:m})=>{const{formatMessage:o}=(0,v.c)(),_=o({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,s.jsx)(H.k1,{"aria-label":_,value:t,onChange:m,children:l.map(({label:d,customValue:n})=>(0,s.jsx)(J.m,{value:n,children:d},n))})};x.defaultProps={value:null},x.propTypes={value:i.string,options:i.arrayOf(i.shape({label:i.string.isRequired,customValue:i.string.isRequired}).isRequired).isRequired,onChange:i.func.isRequired};const Y=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],de=({formatMessage:t,users:l,canReadUsers:m})=>{const o=Object.keys(z).map(d=>({label:t({id:`Settings.permissions.auditLogs.${d}`,defaultMessage:S(d)},{model:void 0}),customValue:d})),_=[{name:"action",metadatas:{customOperators:Y,label:t({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:x,options:o},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:t({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(m&&l){const d=r=>r.username?r.username:r.firstname&&r.lastname?t({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,n=l.map(r=>({label:d(r),customValue:r.id.toString()}));return[..._,{name:"user",metadatas:{customOperators:Y,label:t({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:n,customInput:x},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return _},le=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:t=>t?t.displayName:""}],_e=()=>{const{formatMessage:t}=(0,v.c)(),l=(0,P.w1)(D.s),{allowedActions:{canRead:m,canReadUsers:o}}=(0,a.aU)({...l.settings.auditLogs,readUsers:l.settings.users.read}),[{query:_},d]=(0,a.WK)(),{auditLogs:n,users:r,isLoading:u,hasError:y}=re({canReadAuditLogs:m,canReadUsers:o});(0,a.G0)();const h=de({formatMessage:t,users:r,canReadUsers:o}),K=t({id:"global.auditLogs",defaultMessage:"Audit Logs"}),W=le.map(O=>({...O,metadatas:{...O.metadatas,label:t(O.metadatas.label)}}));return y?(0,s.jsx)(X._,{children:(0,s.jsx)(b.S,{children:(0,s.jsx)(f.k,{paddingTop:8,children:(0,s.jsx)(a.wF,{})})})}):(0,s.jsxs)(w.G,{"aria-busy":u,children:[(0,s.jsx)(a.K8,{name:K}),(0,s.jsx)(k.a,{title:K,subtitle:t({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,s.jsx)(q.U,{startActions:(0,s.jsx)(ee.F,{displayedFilters:h})}),(0,s.jsxs)(b.S,{canRead:m,children:[(0,s.jsx)(a.AL,{contentType:"Audit logs",headers:W,rows:n?.results||[],withBulkActions:!0,isLoading:u,children:(0,s.jsx)(N,{headers:W,rows:n?.results||[],onOpenModal:O=>d({id:O})})}),(0,s.jsx)($,{pagination:n?.pagination})]}),_?.id&&(0,s.jsx)(G,{handleClose:()=>d({id:null},"remove"),logId:_.id})]})},me=()=>{const t=(0,P.w1)(D.s);return(0,s.jsx)(a.rF,{permissions:t.settings.auditLogs.main,children:(0,s.jsx)(_e,{})})}},74253:(B,p,e)=>{e.d(p,{u:()=>D});var s=e(62552),a=e(16048),P=e(48632);function D(g={},L={}){const{id:c="",...f}=g,{get:C}=(0,a.Qn)(),{data:E,isError:T,isLoading:R,refetch:A}=(0,P.useQuery)(["users",c,f],async()=>{const{data:{data:M}}=await C(`/admin/users/${c}`,{params:f});return M},L);return{users:s.useMemo(()=>{let M=[];return E&&("results"in E?Array.isArray(E.results)&&(M=E.results):M=[E]),M},[E]),pagination:s.useMemo(()=>(E&&"pagination"in E)??null,[E]),isLoading:R,isError:T,refetch:A}}},9544:(B,p,e)=>{e.d(p,{m:()=>a});var s=e(65092);const a=s.cb},74432:(B,p,e)=>{e.d(p,{U:()=>P});var s=e(19968),a=e(48936);const P=({startActions:D,endActions:g})=>!D&&!g?null:(0,s.jsxs)(a.C,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,s.jsx)(a.C,{gap:2,wrap:"wrap",children:D}),(0,s.jsx)(a.C,{gap:2,shrink:0,wrap:"wrap",children:g})]})}}]);
