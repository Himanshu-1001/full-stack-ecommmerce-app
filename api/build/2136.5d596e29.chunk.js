"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[2136],{71944:(z,u,s)=>{s.d(u,{f:()=>a});const a=({data:M})=>{try{return Object.keys(M).reduce((O,P)=>{const h=M[P][0];return O[P]={id:h,defaultMessage:h},O},{})}catch{return{}}}},52136:(z,u,s)=>{s.r(u),s.d(u,{SingleSignOn:()=>X,default:()=>ns});var a=s(19968),M=s(20596),O=s(48112),P=s(28464),h=s(35676),W=s(42816),S=s(48936),v=s(63358),T=s(28724),C=s(70996),j=s(28216),I=s(35933),m=s(13384),y=s(5928),n=s(16048),x=s(53305),N=s(13192),V=s(14632),E=s(70516),H=s(17872),B=s(61952),Z=s(62552),Y=s(29088),w=s(21968),U=s(20880),J=s(35184),R=s(97820),q=s(71944),is=s(48632),ls=s(17892),ds=s(31212),rs=s(60056),_s=s(54320),Es=s(5240),cs=s(91892),gs=s(36196),Ds=s(21424),Ms=s(54223),Os=s(18424),ms=s(99568),us=s(12132),Ps=s(85676),hs=s(96556);const ss={fieldsToPick:[],formErrors:{},initialData:{},isLoading:!0,modifiedData:{},showHeaderButtonLoader:!1,showHeaderLoader:!0},es=(e,t)=>(0,Y.cp)(e,o=>{switch(t.type){case"GET_DATA_SUCCEEDED":{o.isLoading=!1,o.showHeaderLoader=!1,o.initialData=U(t.data,e.fieldsToPick),o.modifiedData=U(t.data,e.fieldsToPick);break}case"ON_CANCEL":{o.modifiedData=e.initialData,o.formErrors={};break}case"ON_CHANGE":{t.keys.includes("username")&&!t.value?J(o.modifiedData,t.keys.split("."),null):J(o.modifiedData,t.keys.split("."),t.value);break}case"ON_SUBMIT":{o.showHeaderButtonLoader=!0;break}case"ON_SUBMIT_SUCCEEDED":{o.initialData=U(t.data,e.fieldsToPick),o.modifiedData=U(t.data,e.fieldsToPick),o.showHeaderButtonLoader=!1;break}case"SET_ERRORS":{o.formErrors=t.errors,o.showHeaderButtonLoader=!1;break}default:return o}}),as=async(e,t)=>{let o=null;try{await t.validate(e,{abortEarly:!1})}catch(c){c instanceof R.$D&&(o=(0,n.CK)(c))}return o},ts=(e,t,o)=>{const[{formErrors:c,initialData:F,isLoading:g,modifiedData:A,showHeaderButtonLoader:G,showHeaderLoader:f},l]=Z.useReducer(es,{...ss,fieldsToPick:o}),d=(0,n.eo)(),{lockApp:b,unlockApp:p}=(0,n.H6)(),{get:k,put:Q}=(0,n.Qn)();return Z.useEffect(()=>{(async()=>{try{const{data:{data:r}}=await k("/admin/providers/options");l({type:"GET_DATA_SUCCEEDED",data:r,fieldsToPick:o})}catch{d({type:"warning",message:{id:"notification.error"}})}})()},[]),[{formErrors:c,initialData:F,isLoading:g,modifiedData:A,showHeaderButtonLoader:G,showHeaderLoader:f},l,{handleCancel:()=>{l({type:"ON_CANCEL"})},handleChange:({target:{name:L,value:r}})=>{l({type:"ON_CHANGE",keys:L,value:r})},handleSubmit:async L=>{L.preventDefault();const r=await as(A,e);if(l({type:"SET_ERRORS",errors:r||{}}),!r)try{b(),l({type:"ON_SUBMIT"});const _=w(A,["confirmPassword","registrationToken"]);_.roles&&(_.roles=_.roles.map($=>$.id)),_.ssoLockedRoles&&(_.ssoLockedRoles=[...new Set(_.ssoLockedRoles)]);const{data:{data:D}}=await Q("/admin/providers/options",_);t(D),l({type:"ON_SUBMIT_SUCCEEDED",data:D}),d({type:"success",message:{id:"notification.success.saved"}})}catch(_){const D=_?.response?.payload??{data:{}};D?.data&&typeof D.data=="string"?d({type:"warning",message:D.data}):d({type:"warning",message:D.message});const $=(0,q.f)(D);l({type:"SET_ERRORS",errors:$})}finally{p()}},setField:(L,r)=>{l({type:"ON_CHANGE",keys:L,value:r})}}]},os=R.kt().shape({autoRegister:R.SK().required(n.aO.required),defaultRole:R.Er().when("autoRegister",(e,t)=>e?t.required(n.aO.required):t.nullable()),ssoLockedRoles:R.M$().nullable().of(R.Er().when("ssoLockedRoles",(e,t)=>e?t.required(n.aO.required):t.nullable()))}),X=()=>{(0,n.G0)();const{formatMessage:e}=(0,V.c)(),t=(0,E.w1)(B.s),{isLoading:o,allowedActions:{canUpdate:c,canReadRoles:F}}=(0,n.aU)({...t.settings.sso,readRoles:t.settings.roles.read}),[{formErrors:g,initialData:A,isLoading:G,modifiedData:f,showHeaderButtonLoader:l},,{handleChange:d,handleSubmit:b}]=ts(os,()=>{},["autoRegister","defaultRole","ssoLockedRoles"]),{roles:p,isLoading:k}=(0,H.u)(void 0,{enabled:F}),Q=o||k||G;return(0,a.jsxs)(M._,{children:[(0,a.jsx)(n.K8,{name:"SSO"}),(0,a.jsx)(O.G,{tabIndex:-1,children:(0,a.jsxs)("form",{onSubmit:b,children:[(0,a.jsx)(P.a,{primaryAction:(0,a.jsx)(h.Z,{"data-testid":"save-button",disabled:N(A,f),loading:l,startIcon:(0,a.jsx)(x.c,{}),type:"submit",size:"L",children:e({id:"global.save",defaultMessage:"Save"})}),title:e({id:"Settings.sso.title",defaultMessage:"Single Sign-On"}),subtitle:e({id:"Settings.sso.description",defaultMessage:"Configure the settings for the Single Sign-On feature."})}),(0,a.jsx)(W.S,{children:Q?(0,a.jsx)(n.Wm,{}):(0,a.jsxs)(S.C,{direction:"column",alignItems:"stretch",gap:4,background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:[(0,a.jsx)(v.O,{variant:"delta",as:"h2",children:e({id:"global.settings",defaultMessage:"Settings"})}),(0,a.jsxs)(T.y,{gap:4,children:[(0,a.jsx)(C.C,{col:6,m:6,s:12,children:(0,a.jsx)(j.a,{"aria-label":"autoRegister","data-testid":"autoRegister",disabled:!c,checked:f.autoRegister,hint:e({id:"Settings.sso.form.registration.description",defaultMessage:"Create new user on SSO login if no account exists"}),label:e({id:"Settings.sso.form.registration.label",defaultMessage:"Auto-registration"}),name:"autoRegister",offLabel:e({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:e({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:i=>{d({target:{name:"autoRegister",value:i.target.checked}})}})}),(0,a.jsx)(C.C,{col:6,m:6,s:12,children:(0,a.jsx)(I.M,{disabled:!c,hint:e({id:"Settings.sso.form.defaultRole.description",defaultMessage:"It will attach the new authenticated user to the selected role"}),error:g.defaultRole?e({id:g.defaultRole.id,defaultMessage:g.defaultRole.id}):"",label:e({id:"Settings.sso.form.defaultRole.label",defaultMessage:"Default role"}),name:"defaultRole",onChange:i=>{d({target:{name:"defaultRole",value:i}})},placeholder:e({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),value:f.defaultRole,children:p.map(({id:i,name:K})=>(0,a.jsx)(m.c,{value:i.toString(),children:K},i))})}),(0,a.jsx)(C.C,{col:6,m:6,s:12,children:(0,a.jsx)(y.e,{disabled:!c,hint:e({id:"Settings.sso.form.localAuthenticationLock.description",defaultMessage:"Select the roles for which you want to disable the local authentication"}),error:g.ssoLockedRoles?e({id:g.ssoLockedRoles.id,defaultMessage:g.ssoLockedRoles.id}):"",label:e({id:"Settings.sso.form.localAuthenticationLock.label",defaultMessage:"Local authentication lock-out"}),name:"ssoLockedRoles",onChange:i=>{d({target:{name:"ssoLockedRoles",value:i}})},placeholder:e({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),onClear:()=>{d({target:{name:"ssoLockedRoles"}})},value:f.ssoLockedRoles||[],withTags:!0,children:p.map(({id:i,name:K})=>(0,a.jsx)(y.eI,{value:i.toString(),children:K},i))})})]})]})})]})})]})},ns=()=>{const e=(0,E.w1)(B.s);return(0,a.jsx)(n.rF,{permissions:e.settings.sso.main,children:(0,a.jsx)(X,{})})}},17872:(z,u,s)=>{s.d(u,{u:()=>h});var a=s(62552),M=s(16048),O=s(14632),P=s(48632);const h=(W={},S={})=>{const{id:v="",...T}=W,{get:C}=(0,M.Qn)(),{locale:j}=(0,O.c)(),I=(0,M.In)(j,{sensitivity:"base"}),{data:m,error:y,isError:n,isLoading:x,refetch:N}=(0,P.useQuery)(["roles",v,T],async()=>{const{data:E}=await C(`/admin/roles/${v??""}`,{params:T});return E},S);return{roles:a.useMemo(()=>{let E=[];return m&&(Array.isArray(m.data)?E=m.data:E=[m.data]),[...E].sort((H,B)=>I.compare(H.name,B.name))},[m,I]),error:y,isError:n,isLoading:x,refetch:N}}}}]);
