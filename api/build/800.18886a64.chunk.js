"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[800],{10800:(k,K,s)=>{s.d(K,{App:()=>Ae});var e=s(19968),E=s(49008),i=s(2832),y=s(62552),N=s(11208),H=s(2931),p=s(63358),V=s(25824),Z=s(62492),S=s(3548),T=s(35676),g=s(48936),u=s(48112),I=s(5e3),W=s(28464),F=s(65280),z=s(23264),G=s(14448),C=s(42816),J=s(36132),Y=s(76512),w=s(9752),oe=s(28724),le=s(70996),de=s(6496),Q=s(53804),X=s(80700),t=s(16048),ce=s(89940),ge=s(71324),_e=s(37776),pe=s(67636),q=s(79848),me=s(48636),B=s(14632),$=s(69372),ee=s(54223),se=s(97820),he=s(5540);const ue=se.kt().shape({name:se.Qb().trim().required()}).required().noUnknown(),ae=({handleClose:a,handleSubmit:r,initialValues:l,isLoading:n=!1})=>{const{formatMessage:o}=(0,B.c)();return(0,e.jsxs)(N.E,{onClose:a,labelledBy:"title",children:[(0,e.jsx)(H.k,{children:(0,e.jsx)(p.O,{id:"title",fontWeight:"bold",textColor:"neutral800",children:o({id:"content-releases.modal.add-release-title",defaultMessage:"New release"})})}),(0,e.jsx)(ee.QJ,{validateOnChange:!1,onSubmit:r,initialValues:l,validationSchema:ue,children:({values:x,errors:M,handleChange:P})=>(0,e.jsxs)(ee.QF,{children:[(0,e.jsx)(V.a,{children:(0,e.jsx)(Z.g,{label:o({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"}),name:"name",value:x.name,error:M.name,onChange:P,required:!0})}),(0,e.jsx)(S._,{startActions:(0,e.jsx)(T.Z,{onClick:a,variant:"tertiary",name:"cancel",children:o({id:"cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(T.Z,{name:"submit",loading:n,disabled:!x.name,type:"submit",children:o({id:"content-releases.modal.form.button.submit",defaultMessage:"Continue"})})})]})})]})},Ee=(0,$.cp)(g.C)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:a})=>a.borderRadius};
  border-bottom-left-radius: ${({theme:a})=>a.borderRadius};
  border-top: 1px solid ${({theme:a})=>a.colors.neutral150};
`,xe=(0,$.cp)(g.C)`
  align-self: stretch;
`,Me=(0,$.cp)(ce.c)`
  width: ${({theme:a})=>a.spaces[4]};
  height: ${({theme:a})=>a.spaces[4]};
  path {
    fill: ${({theme:a})=>a.colors.neutral600};
  }
`,je=(0,$.cp)(ge.c)`
  width: ${({theme:a})=>a.spaces[4]};
  height: ${({theme:a})=>a.spaces[4]};
  path {
    fill: ${({theme:a})=>a.colors.danger600};
  }
`,te=({onClick:a,children:r})=>(0,e.jsx)(xe,{paddingTop:2,paddingBottom:2,paddingLeft:4,paddingRight:4,alignItems:"center",gap:2,as:"button",hasRadius:!0,onClick:a,children:r}),ne=({toggleEditReleaseModal:a,toggleWarningSubmit:r,children:l})=>{const{formatMessage:n}=(0,B.c)(),{releaseId:o}=(0,E.W4)(),[x,M]=y.useState(!1),P=y.useRef(null),{data:m,isLoading:f,isError:b}=(0,i.u)({id:o}),[U,{isLoading:L}]=(0,i.c)(),O=(0,t.eo)(),{formatAPIError:A}=(0,t.An)(),d=m?.data,h=()=>{M(v=>!v)},_=()=>{a(),h()},R=async()=>{const v=await U({id:o});"data"in v?O({type:"success",message:n({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})}):(0,i.i)(v.error)?O({type:"warning",message:A(v.error)}):O({type:"warning",message:n({id:"notification.error",defaultMessage:"An error occurred"})})},c=()=>{r(),h()};if(f)return(0,e.jsx)(u.G,{"aria-busy":f,children:(0,e.jsx)(I.k,{paddingBottom:8,children:(0,e.jsx)(t.Wm,{})})});if(b||!d)return(0,e.jsx)(u.G,{children:(0,e.jsx)(I.k,{paddingBottom:8,children:(0,e.jsx)(t.wF,{})})});const j=d.actions.meta.count||0,D=`${d.createdBy.firstname} ${d.createdBy.lastname}`;return(0,e.jsxs)(u.G,{"aria-busy":f,children:[(0,e.jsx)(I.k,{paddingBottom:8,children:(0,e.jsx)(W.a,{title:d.name,subtitle:n({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:j}),navigationAction:(0,e.jsx)(F.c,{startIcon:(0,e.jsx)(_e.c,{}),to:"/plugins/content-releases",children:n({id:"global.back",defaultMessage:"Back"})}),primaryAction:!d.releasedAt&&(0,e.jsxs)(g.C,{gap:2,children:[(0,e.jsx)(z.w,{label:n({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release actions"}),ref:P,onClick:h,children:(0,e.jsx)(pe.c,{})}),x&&(0,e.jsxs)(G._k,{source:P,placement:"bottom-end",onDismiss:h,spacing:4,minWidth:"242px",children:[(0,e.jsxs)(g.C,{alignItems:"center",justifyContent:"center",direction:"column",padding:1,children:[(0,e.jsx)(t.Yj,{permissions:i.P.update,children:(0,e.jsxs)(te,{onClick:_,children:[(0,e.jsx)(Me,{}),(0,e.jsx)(p.O,{ellipsis:!0,children:n({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})})]})}),(0,e.jsx)(t.Yj,{permissions:i.P.delete,children:(0,e.jsxs)(te,{onClick:c,children:[(0,e.jsx)(je,{}),(0,e.jsx)(p.O,{ellipsis:!0,textColor:"danger600",children:n({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})})]})})]}),(0,e.jsxs)(Ee,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:5,children:[(0,e.jsx)(p.O,{variant:"pi",fontWeight:"bold",children:n({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),(0,e.jsxs)(p.O,{variant:"pi",color:"neutral300",children:[(0,e.jsx)(t.od,{timestamp:new Date(d.createdAt)}),n({id:"content-releases.header.actions.created.description",defaultMessage:" by {createdBy}"},{createdBy:D})]})]})]}),(0,e.jsx)(T.Z,{size:"S",variant:"tertiary",children:n({id:"content-releases.header.actions.refresh",defaultMessage:"Refresh"})}),(0,e.jsx)(t.Yj,{permissions:i.P.publish,children:(0,e.jsx)(T.Z,{size:"S",variant:"default",onClick:R,loading:L,disabled:d.actions.meta.count===0,children:n({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})})})]})})}),l]})},fe=()=>{const{formatMessage:a}=(0,B.c)(),{releaseId:r}=(0,E.W4)(),[{query:l}]=(0,t.WK)(),n=(0,t.eo)(),{formatAPIError:o}=(0,t.An)(),{data:x,isLoading:M,isError:P}=(0,i.u)({id:r}),m=x?.data,{isLoading:f,isFetching:b,isError:U,data:L}=(0,i.d)({...l,releaseId:r}),[O]=(0,i.e)(),A=async(_,R)=>{const c=await O({params:{releaseId:r,actionId:R},body:{type:_.target.value}});"error"in c&&((0,i.i)(c.error)?n({type:"warning",message:o(c.error)}):n({type:"warning",message:a({id:"notification.error",defaultMessage:"An error occurred"})}))};if(f||M)return(0,e.jsx)(C.S,{children:(0,e.jsx)(t.Wm,{})});if(U||P||!m)return(0,e.jsx)(C.S,{children:(0,e.jsx)(t.wF,{})});const d=L?.data,h=L?.meta;return!d||!d.length?(0,e.jsx)(C.S,{children:(0,e.jsx)(J.S,{content:a({id:"content-releases.pages.Details.empty-state.content",defaultMessage:"This release is empty."}),icon:(0,e.jsx)(q.c,{width:"10rem"})})}):(0,e.jsx)(C.S,{children:(0,e.jsxs)(g.C,{gap:4,direction:"column",alignItems:"stretch",children:[(0,e.jsx)(t.oJ.Root,{rows:d.map(_=>({..._,id:Number(_.entry.id)})),colCount:d.length,isLoading:f,isFetching:b,children:(0,e.jsxs)(t.oJ.Content,{children:[(0,e.jsxs)(t.oJ.Head,{children:[(0,e.jsx)(t.oJ.HeaderCell,{fieldSchemaType:"string",label:a({id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"}),name:"name"}),(0,e.jsx)(t.oJ.HeaderCell,{fieldSchemaType:"string",label:a({id:"content-releases.page.ReleaseDetails.table.header.label.locale",defaultMessage:"locale"}),name:"locale"}),(0,e.jsx)(t.oJ.HeaderCell,{fieldSchemaType:"string",label:a({id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"}),name:"content-type"}),(0,e.jsx)(t.oJ.HeaderCell,{fieldSchemaType:"string",label:a({id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"}),name:"action"})]}),(0,e.jsx)(t.oJ.LoadingBody,{}),(0,e.jsx)(t.oJ.Body,{children:d.map(({id:_,type:R,entry:c})=>(0,e.jsxs)(Y.Tr,{children:[(0,e.jsx)(w.Td,{children:(0,e.jsx)(p.O,{children:`${c.contentType.mainFieldValue||c.id}`})}),(0,e.jsx)(w.Td,{children:(0,e.jsx)(p.O,{children:`${c?.locale?.name?c.locale.name:"-"}`})}),(0,e.jsx)(w.Td,{children:(0,e.jsx)(p.O,{children:c.contentType.displayName||""})}),(0,e.jsx)(w.Td,{children:m.releasedAt?(0,e.jsx)(p.O,{children:a({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:R==="publish",b:j=>(0,e.jsx)(p.O,{fontWeight:"bold",children:j})})}):(0,e.jsx)(i.R,{selected:R,handleChange:j=>A(j,_),name:`release-action-${_}-type`})})]},_))})]})}),(0,e.jsxs)(g.C,{paddingTop:4,alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.A7,{defaultValue:h?.pagination?.pageSize.toString()}),(0,e.jsx)(t.cZ,{pagination:{pageCount:h?.pagination?.pageCount||0}})]})]})})},De=()=>{const{formatMessage:a}=(0,B.c)(),{releaseId:r}=(0,E.W4)(),l=(0,t.eo)(),{formatAPIError:n}=(0,t.An)(),{push:o}=(0,E.Uz)(),[x,M]=y.useState(!1),[P,m]=y.useState(!1),{isLoading:f,data:b,isSuccess:U}=(0,i.u)({id:r}),[L,{isLoading:O}]=(0,i.a)(),[A,{isLoading:d}]=(0,i.b)(),h=()=>{M(D=>!D)},_=()=>m(D=>!D);if(f)return(0,e.jsx)(ne,{toggleEditReleaseModal:h,toggleWarningSubmit:_,children:(0,e.jsx)(C.S,{children:(0,e.jsx)(t.Wm,{})})});const R=U&&b?.data?.name||"",c=async D=>{const v=await L({id:r,name:D.name});"data"in v?l({type:"success",message:a({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}):(0,i.i)(v.error)?l({type:"warning",message:n(v.error)}):l({type:"warning",message:a({id:"notification.error",defaultMessage:"An error occurred"})}),h()},j=async()=>{const D=await A({id:r});"data"in D?o("/plugins/content-releases"):(0,i.i)(D.error)?l({type:"warning",message:n(D.error)}):l({type:"warning",message:a({id:"notification.error",defaultMessage:"An error occurred"})})};return(0,e.jsxs)(ne,{toggleEditReleaseModal:h,toggleWarningSubmit:_,children:[(0,e.jsx)(fe,{}),x&&(0,e.jsx)(ae,{handleClose:h,handleSubmit:c,isLoading:f||O,initialValues:{name:R||""}}),(0,e.jsx)(t.cz,{bodyText:{id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"},isOpen:P,isConfirmButtonLoading:d,onToggleDialog:_,onConfirm:j})]})},Pe=()=>(0,e.jsx)(t.Yj,{permissions:i.P.main,children:(0,e.jsx)(De,{})}),ie=({isLoading:a,totalReleases:r,onClickAddRelease:l,children:n})=>{const{formatMessage:o}=(0,B.c)();return(0,e.jsxs)(u.G,{"aria-busy":a,children:[(0,e.jsx)(W.a,{title:o({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),subtitle:!a&&o({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"{number, plural, =0 {No releases} one {# release} other {# releases}}"},{number:r}),primaryAction:(0,e.jsx)(t.Yj,{permissions:i.P.create,children:(0,e.jsx)(T.Z,{startIcon:(0,e.jsx)(me.c,{}),onClick:l,children:o({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})})})}),n]})},Oe=(0,$.cp)(he.c)`
  display: block;
`,re=({sectionTitle:a,releases:r=[],isError:l=!1})=>{const{formatMessage:n}=(0,B.c)();return l?(0,e.jsx)(t.wF,{}):r?.length===0?(0,e.jsx)(J.S,{content:n({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:a}),icon:(0,e.jsx)(q.c,{width:"10rem"})}):(0,e.jsx)(oe.y,{gap:4,children:r.map(({id:o,name:x,actions:M})=>(0,e.jsx)(le.C,{col:3,s:6,xs:12,children:(0,e.jsx)(Oe,{href:`content-releases/${o}`,isExternal:!1,children:(0,e.jsxs)(g.C,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:2,children:[(0,e.jsx)(p.O,{as:"h3",variant:"delta",fontWeight:"bold",children:x}),(0,e.jsx)(p.O,{variant:"pi",children:n({id:"content-releases.page.Releases.release-item.entries",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:M.meta.count})})]})})},o))})},Re={name:""},ye=()=>{const[a,r]=y.useState(!1),l=(0,t.eo)(),{formatMessage:n}=(0,B.c)(),{push:o}=(0,E.Uz)(),{formatAPIError:x}=(0,t.An)(),[{query:M},P]=(0,t.WK)(),m=(0,i.f)(M),[f,{isLoading:b}]=(0,i.g)(),{isLoading:U,isSuccess:L,isError:O}=m,A=()=>{r(c=>!c)};if(U)return(0,e.jsx)(ie,{onClickAddRelease:A,isLoading:!0,children:(0,e.jsx)(C.S,{children:(0,e.jsx)(t.Wm,{})})});const d=L&&m.currentData?.meta?.pagination?.total||0,h=c=>{P({...M,page:1,pageSize:m?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:c!==0}}})},_=m?.currentData?.meta?.activeTab||"pending",R=async c=>{const j=await f({name:c.name});"data"in j?(l({type:"success",message:n({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),o(`/plugins/content-releases/${j.data.data.id}`)):(0,i.i)(j.error)?l({type:"warning",message:x(j.error)}):l({type:"warning",message:n({id:"notification.error",defaultMessage:"An error occurred"})})};return(0,e.jsxs)(ie,{onClickAddRelease:A,totalReleases:d,children:[(0,e.jsx)(C.S,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(de.M,{label:n({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),variant:"simple",initialSelectedTabIndex:["pending","done"].indexOf(_),onTabChange:h,children:[(0,e.jsx)(I.k,{paddingBottom:8,children:(0,e.jsxs)(Q.k,{children:[(0,e.jsx)(Q.s,{children:n({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending"})}),(0,e.jsx)(Q.s,{children:n({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]})}),(0,e.jsxs)(X.o,{children:[(0,e.jsx)(X.G,{children:(0,e.jsx)(re,{sectionTitle:"pending",releases:m?.currentData?.data,isError:O})}),(0,e.jsx)(X.G,{children:(0,e.jsx)(re,{sectionTitle:"done",releases:m?.currentData?.data,isError:O})})]})]}),d>0&&(0,e.jsxs)(g.C,{paddingTop:4,alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.A7,{options:["8","16","32","64"],defaultValue:m?.currentData?.meta?.pagination?.pageSize.toString()}),(0,e.jsx)(t.cZ,{pagination:{pageCount:m?.currentData?.meta?.pagination?.pageCount||0}})]})]})}),a&&(0,e.jsx)(ae,{handleClose:A,handleSubmit:R,isLoading:b,initialValues:Re})]})},Ce=()=>(0,e.jsx)(t.Yj,{permissions:i.P.main,children:(0,e.jsx)(ye,{})}),Ae=()=>(0,e.jsxs)(E.Wk,{children:[(0,e.jsx)(E.kX,{exact:!0,path:`/plugins/${i.p}`,component:Ce}),(0,e.jsx)(E.kX,{exact:!0,path:`/plugins/${i.p}/:releaseId`,component:Pe})]})},65280:(k,K,s)=>{s.d(K,{c:()=>T});var e=s(19968),E=s(62552),i=s(73648),y=s(39380),N=s(69372),H=s(53744),p=s(63358),V=s(5e3);const Z=N.cp.a`
  display: inline-flex;
  align-items: center;
  text-decoration: none;
  pointer-events: ${({disabled:g})=>g?"none":void 0};
  color: ${({disabled:g,theme:u})=>g?u.colors.neutral600:u.colors.primary600};

  svg path {
    transition: fill 150ms ease-out;
    fill: currentColor;
  }

  svg {
    font-size: ${10/16}rem;
  }

  ${p.O} {
    transition: color 150ms ease-out;
    color: currentColor;
  }

  &:hover {
    color: ${({theme:g})=>g.colors.primary500};
  }

  &:active {
    color: ${({theme:g})=>g.colors.primary700};
  }

  ${H.Md};
`,S=(0,N.cp)(V.k)`
  display: flex;
`,T=E.forwardRef(({children:g,href:u,to:I,disabled:W=!1,startIcon:F,endIcon:z,...G},C)=>{const J=u?"_blank":void 0,Y=u?"noreferrer noopener":void 0;return(0,e.jsxs)(Z,{as:I&&!W?y.Af:"a",target:J,rel:Y,to:W?void 0:I,href:W?"#":u,disabled:W,ref:C,...G,children:[F&&(0,e.jsx)(S,{as:"span","aria-hidden":!0,paddingRight:2,children:F}),(0,e.jsx)(p.O,{children:g}),z&&!u&&(0,e.jsx)(S,{as:"span","aria-hidden":!0,paddingLeft:2,children:z}),u&&(0,e.jsx)(S,{as:"span","aria-hidden":!0,paddingLeft:2,children:(0,e.jsx)(i.c,{})})]})})},37776:(k,K,s)=>{s.d(K,{c:()=>i});var e=s(19968);const E=y=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...y,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),i=E}}]);
