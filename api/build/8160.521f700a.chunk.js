"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[8160],{76232:(G,g,s)=>{s.d(g,{F:()=>y});var e=s(19968),t=s(62552),l=s(5e3),i=s(35676),d=s(16048),x=s(60012),c=s(33104),P=s(14632);const y=({displayedFilters:r})=>{const[M,p]=(0,t.useState)(!1),{formatMessage:A}=(0,P.c)(),m=(0,t.useRef)(),f=()=>{p(J=>!J)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(l.k,{paddingTop:1,paddingBottom:1,children:[(0,e.jsx)(i.Z,{variant:"tertiary",ref:m,startIcon:(0,e.jsx)(x.c,{}),onClick:f,size:"S",children:A({id:"app.utils.filters",defaultMessage:"Filters"})}),M&&(0,e.jsx)(d.SI,{displayedFilters:r,isVisible:M,onToggle:f,source:m})]}),(0,e.jsx)(d.aW,{filtersSchema:r})]})};y.propTypes={displayedFilters:c.arrayOf(c.shape({name:c.string.isRequired,metadatas:c.shape({label:c.string}),fieldSchema:c.shape({type:c.string})})).isRequired}},68160:(G,g,s)=>{s.r(g),s.d(g,{U:()=>fe,i:()=>Ue});var e=s(19968),t=s(16048),l=s(70516),i=s(61952),d=s(62552),x=s(35676),c=s(48744),P=s(76512),y=s(9752),r=s(19576),M=s(63358),p=s(48936),A=s(23264),m=s(5e3),f=s(11208),J=s(2931),oe=s(25824),ae=s(28724),W=s(70996),v=s(3548),h=s(48112),S=s(28464),X=s(74432),w=s(42816),k=s(12132),O=s(14632),z=s(48632),ne=s(49008),le=s(74253),b=s(60056),de=s(76232),j=s(92508),he=s(89940),Oe=s(71324),o=s(33104),De=s(5848),Pe=s(39820),Ce=s(54223),ue=s(20900),q=s(97820);const Ee=({onClick:a})=>{const{formatMessage:_}=(0,O.c)();return(0,e.jsx)(x.Z,{onClick:a,startIcon:(0,e.jsx)(j.c,{}),size:"S",children:_({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})};Ee.propTypes={onClick:o.func.isRequired};const ce=({canDelete:a,headers:_,entriesToDelete:T,onClickDelete:ee,onSelectRow:$,withMainAction:F,withBulkActions:B,rows:U})=>{const{push:D,location:{pathname:Z}}=(0,ne.Uz)(),{formatMessage:C}=(0,O.c)();return(0,e.jsx)(c.K,{children:U.map(n=>{const Q=T.findIndex(I=>I===n.id)!==-1;return(0,e.jsxs)(P.Tr,{...(0,t.on)({fn:()=>D(`${Z}/${n.id}`),condition:B}),children:[F&&(0,e.jsx)(y.Td,{...t.Ii,children:(0,e.jsx)(r.c,{"aria-label":C({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,i.g)(n.firstname,n.lastname)}),checked:Q,onChange:()=>{$({name:n.id,value:!Q})}})}),_.map(({key:I,cellFormatter:V,name:K,...N})=>(0,e.jsx)(y.Td,{children:typeof V=="function"?V(n,{key:I,name:K,formatMessage:C,...N}):(0,e.jsx)(M.O,{textColor:"neutral800",children:n[K]||"-"})},I)),B&&(0,e.jsx)(y.Td,{children:(0,e.jsxs)(p.C,{justifyContent:"end",children:[(0,e.jsx)(A.w,{onClick:()=>D(`${Z}/${n.id}`),label:C({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,i.g)(n.firstname,n.lastname)}),noBorder:!0,icon:(0,e.jsx)(he.c,{})}),a&&(0,e.jsx)(m.k,{paddingLeft:1,...t.Ii,children:(0,e.jsx)(A.w,{onClick:()=>ee(n.id),label:C({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,i.g)(n.firstname,n.lastname)}),noBorder:!0,icon:(0,e.jsx)(Oe.c,{})})})]})})]},n.id)})})};ce.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},ce.propTypes={canDelete:o.bool,entriesToDelete:o.array,headers:o.array.isRequired,onClickDelete:o.func,onSelectRow:o.func,rows:o.array,withBulkActions:o.bool,withMainAction:o.bool};const ge={firstname:"",lastname:"",email:"",roles:[]},xe=[],ye=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Ae=q.kt().shape({firstname:q.Qb().trim().required(t.aO.required),lastname:q.Qb(),email:q.Qb().email(t.aO.email).required(t.aO.required),roles:q.M$().min(1,t.aO.required).required(t.aO.required)}),je={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Me=({onSuccess:a,onToggle:_})=>{const[T,ee]=(0,d.useState)("create"),[$,F]=(0,d.useState)(!1),[B,U]=(0,d.useState)(null),{formatMessage:D}=(0,O.c)(),Z=(0,t.eo)(),{lockApp:C,unlockApp:n}=(0,t.H6)(),{post:Q}=(0,t.Qn)(),I=(0,b.p)(xe,async()=>(await s.e(1224).then(s.bind(s,81224))).ROLE_LAYOUT,{combine(E,R){return[...E,R]},defaultValue:[]}),V=(0,b.p)(ge,async()=>(await s.e(1224).then(s.bind(s,81224))).FORM_INITIAL_VALUES,{combine(E,R){return{...E,...R}},defaultValue:ge}),K=(0,b.p)(ue.M,async()=>(await s.e(892).then(s.bind(s,50892))).MagicLinkEE),N=(0,z.useMutation)(E=>Q("/admin/users",E),{async onSuccess({data:E}){U(E.data.registrationToken),await a(),re(),F(!1)},onError(E){throw F(!1),Z({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),E},onSettled(){n()}}),se=D({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),ie=async(E,{setErrors:R})=>{C(),F(!0);try{await N.mutateAsync(E)}catch(H){n(),H?.response?.data?.error.message==="Email already taken"&&R({email:H.response.data.error.message})}},re=()=>{u?ee(u):_()},{buttonSubmitLabel:te,isDisabled:Y,next:u}=je[T],Ie=T==="create"?(0,e.jsx)(x.Z,{type:"submit",loading:$,children:D(te)}):(0,e.jsx)(x.Z,{type:"button",loading:$,onClick:_,children:D(te)});return K?(0,e.jsxs)(f.E,{onClose:_,labelledBy:"title",children:[(0,e.jsx)(J.k,{children:(0,e.jsx)(De.M,{label:se,children:(0,e.jsx)(Pe.i,{isCurrent:!0,children:se})})}),(0,e.jsx)(Ce.QJ,{enableReinitialize:!0,initialValues:V,onSubmit:ie,validationSchema:Ae,validateOnChange:!1,children:({errors:E,handleChange:R,values:H})=>(0,e.jsxs)(t.QF,{children:[(0,e.jsx)(oe.a,{children:(0,e.jsxs)(p.C,{direction:"column",alignItems:"stretch",gap:6,children:[T!=="create"&&(0,e.jsx)(K,{registrationToken:B}),(0,e.jsxs)(m.k,{children:[(0,e.jsx)(M.O,{variant:"beta",as:"h2",children:D({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,e.jsx)(m.k,{paddingTop:4,children:(0,e.jsx)(p.C,{direction:"column",alignItems:"stretch",gap:1,children:(0,e.jsx)(ae.y,{gap:5,children:ye.map(_e=>_e.map(L=>(0,e.jsx)(W.C,{...L.size,children:(0,e.jsx)(t.u,{...L,disabled:Y,error:E[L.name],onChange:R,value:H[L.name]})},L.name)))})})})]}),(0,e.jsxs)(m.k,{children:[(0,e.jsx)(M.O,{variant:"beta",as:"h2",children:D({id:"global.roles",defaultMessage:"User's role"})}),(0,e.jsx)(m.k,{paddingTop:4,children:(0,e.jsxs)(ae.y,{gap:5,children:[(0,e.jsx)(W.C,{col:6,xs:12,children:(0,e.jsx)(ue.S,{disabled:Y,error:E.roles,onChange:R,value:H.roles})}),I.map(_e=>_e.map(L=>(0,e.jsx)(W.C,{...L.size,children:(0,e.jsx)(t.u,{...L,disabled:Y,onChange:R,value:H[L.name]})},L.name)))]})})]})]})}),(0,e.jsx)(v._,{startActions:(0,e.jsx)(x.Z,{variant:"tertiary",onClick:_,type:"button",children:D({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:Ie})]})})]}):null};Me.propTypes={onToggle:o.func.isRequired,onSuccess:o.func.isRequired};const me=({pagination:a})=>(0,e.jsx)(m.k,{paddingTop:4,children:(0,e.jsxs)(p.C,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.A7,{}),(0,e.jsx)(t.cZ,{pagination:a})]})});me.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},me.propTypes={pagination:o.shape({page:o.number,pageCount:o.number,pageSize:o.number,total:o.number})};const Te=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Le=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:a},{formatMessage:_}){return(0,e.jsx)(M.O,{textColor:"neutral800",children:a.map(T=>_({id:`Settings.permissions.users.${T.code}`,defaultMessage:T.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:a},{formatMessage:_}){return(0,e.jsxs)(p.C,{children:[(0,e.jsx)(t.sD,{isActive:a,variant:a?"success":"danger"}),(0,e.jsx)(M.O,{textColor:"neutral800",children:_({id:a?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:a?"Active":"Inactive"})})]})}}],pe=["ee","license-limit-info"],fe=()=>{const{post:a}=(0,t.Qn)(),{formatAPIError:_}=(0,t.An)(),[T,ee]=(0,d.useState)(!1),$=(0,l.w1)(i.s),{allowedActions:{canCreate:F,canDelete:B,canRead:U}}=(0,t.aU)($.settings.users),D=(0,z.useQueryClient)(),Z=(0,t.eo)(),{formatMessage:C}=(0,O.c)(),{search:n}=(0,ne.IT)();(0,t.G0)();const{users:Q,pagination:I,isError:V,isLoading:K,refetch:N}=(0,le.u)(k.parse(n,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:U}),se=(0,b.p)(Ee,async()=>(await s.e(288).then(s.bind(s,57907))).CreateActionEE),ie=Le.map(u=>({...u,metadatas:{...u.metadatas,label:C(u.metadatas.label)}})),re=C({id:"global.users",defaultMessage:"Users"}),te=()=>{ee(u=>!u)},Y=(0,z.useMutation)(async u=>{await a("/admin/users/batch-delete",{ids:u})},{async onSuccess(){await N(),await D.refetchQueries(pe)},onError(u){Z({type:"warning",message:{id:"notification.error",message:_(u),defaultMessage:"An error occured"}})}});return se?(0,e.jsxs)(h.G,{"aria-busy":K,children:[(0,e.jsx)(t.K8,{name:"Users"}),(0,e.jsx)(S.a,{primaryAction:F&&(0,e.jsx)(se,{onClick:te}),title:re,subtitle:C({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),U&&(0,e.jsx)(X.U,{startActions:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.w9,{label:C({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:re})}),(0,e.jsx)(de.F,{displayedFilters:Te})]})}),(0,e.jsxs)(w.S,{canRead:U,children:[!U&&(0,e.jsx)(t.o5,{}),V&&(0,e.jsx)("div",{children:"TODO: An error occurred"}),U&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.AL,{contentType:"Users",isLoading:K,onConfirmDeleteAll:Y.mutateAsync,onConfirmDelete:u=>Y.mutateAsync([u]),headers:ie,rows:Q,withBulkActions:!0,withMainAction:B,children:(0,e.jsx)(ce,{canDelete:B,headers:ie,rows:Q,withBulkActions:!0,withMainAction:B})}),I&&(0,e.jsx)(me,{pagination:I})]})]}),T&&(0,e.jsx)(Me,{onSuccess:async()=>{await N(),await D.refetchQueries(pe)},onToggle:te})]}):null},ve=()=>{const a=(0,b.p)(fe,async()=>(await s.e(3168).then(s.bind(s,63168))).UserListPageEE);return a?(0,e.jsx)(a,{}):null},Ue=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=(0,l.w1)(i.s);return(0,e.jsx)(t.rF,{permissions:a.settings.users.main,children:(0,e.jsx)(ve,{})})}},Symbol.toStringTag,{value:"Module"}))},20900:(G,g,s)=>{s.d(g,{M:()=>m,S:()=>W,a:()=>A});var e=s(19968),t=s(33104),l=s(14632),i=s(60056),d=s(23264),x=s(35933),c=s(13384),P=s(16048),y=s(32680),r=s(24144),M=s(48632),p=s(69372);const A=({children:v,target:h})=>{const S=(0,P.eo)(),{formatMessage:X}=(0,l.c)(),{copy:w}=(0,P.UC)(),k=X({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),O=async()=>{await w(h)&&S({type:"info",message:{id:"notification.link-copied"}})};return(0,e.jsx)(P._y,{endAction:(0,e.jsx)(d.w,{label:k,noBorder:!0,icon:(0,e.jsx)(y.c,{}),onClick:O}),title:h,titleEllipsis:!0,subtitle:v,icon:(0,e.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})};A.propTypes={children:t.oneOfType([t.element,t.string]).isRequired,target:t.string.isRequired};const m=({registrationToken:v})=>{const{formatMessage:h}=(0,l.c)(),S=`${window.location.origin}${(0,i.T)()}/auth/register?registrationToken=${v}`;return(0,e.jsx)(A,{target:S,children:h({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})};m.defaultProps={registrationToken:""},m.propTypes={registrationToken:t.string};const f=(0,p.xZ)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,J=p.cp.div`
  animation: ${f} 2s infinite linear;
`,oe=()=>(0,e.jsx)(J,{children:(0,e.jsx)(r.c,{})}),ae=async()=>{const{get:v}=(0,P.YF)(),{data:h}=await v("/admin/roles");return h.data},W=({disabled:v,error:h,onChange:S,value:X})=>{const{status:w,data:k}=(0,M.useQuery)(["roles"],ae,{staleTime:5e4}),{formatMessage:O}=(0,l.c)(),z=h?O({id:h,defaultMessage:h}):"",ne=O({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),le=O({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),b=O({id:"app.components.Select.placeholder",defaultMessage:"Select"}),de=w==="loading"?(0,e.jsx)(oe,{}):void 0;return(0,e.jsx)(x.M,{id:"roles",disabled:v,error:z,hint:le,label:ne,name:"roles",onChange:j=>{S({target:{name:"roles",value:j}})},placeholder:b,multi:!0,startIcon:de,value:X.map(j=>j.toString()),withTags:!0,required:!0,children:(k||[]).map(j=>(0,e.jsx)(c.c,{value:j.id.toString(),children:O({id:`global.${j.code}`,defaultMessage:j.name})},j.id))})};W.defaultProps={disabled:!1,error:void 0},W.propTypes={disabled:t.bool,error:t.string,onChange:t.func.isRequired,value:t.array.isRequired}},74253:(G,g,s)=>{s.d(g,{u:()=>i});var e=s(62552),t=s(16048),l=s(48632);function i(d={},x={}){const{id:c="",...P}=d,{get:y}=(0,t.Qn)(),{data:r,isError:M,isLoading:p,refetch:A}=(0,l.useQuery)(["users",c,P],async()=>{const{data:{data:f}}=await y(`/admin/users/${c}`,{params:P});return f},x);return{users:e.useMemo(()=>{let f=[];return r&&("results"in r?Array.isArray(r.results)&&(f=r.results):f=[r]),f},[r]),pagination:e.useMemo(()=>(r&&"pagination"in r)??null,[r]),isLoading:p,isError:M,refetch:A}}},74432:(G,g,s)=>{s.d(g,{U:()=>l});var e=s(19968),t=s(48936);const l=({startActions:i,endActions:d})=>!i&&!d?null:(0,e.jsxs)(t.C,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(t.C,{gap:2,wrap:"wrap",children:i}),(0,e.jsx)(t.C,{gap:2,shrink:0,wrap:"wrap",children:d})]})},92508:(G,g,s)=>{s.d(g,{c:()=>l});var e=s(19968);const t=i=>(0,e.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...i,children:[(0,e.jsx)("path",{fill:"#32324D",d:"M0 2.8A.8.8 0 0 1 .8 2h22.4a.8.8 0 0 1 .8.8v2.71a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2.8Z"}),(0,e.jsx)("path",{fill:"#32324D",d:"M1.922 7.991C.197 6.675 0 6.252 0 5.289h23.953c.305 1.363-1.594 2.506-2.297 3.125-1.953 1.363-6.253 4.36-7.828 5.45-1.575 1.09-3.031.455-3.562 0-2.063-1.41-6.62-4.557-8.344-5.873ZM22.8 18H1.2c-.663 0-1.2.471-1.2 1.053v1.894C0 21.529.537 22 1.2 22h21.6c.663 0 1.2-.471 1.2-1.053v-1.894c0-.582-.537-1.053-1.2-1.053Z"}),(0,e.jsx)("path",{fill:"#32324D",d:"M0 9.555v10.972h24V9.554c-2.633 1.95-8.367 6.113-9.96 7.166-1.595 1.052-3.352.438-4.032 0L0 9.555Z"})]}),l=t}}]);
