"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[5396],{70632:(F,g,s)=>{s.r(g),s.d(g,{default:()=>ds});var t=s(19968),e=s(16048),E=s(70516),D=s(61952),l=s(62552),L=s(76512),_=s(9752),i=s(63358),x=s(48936),r=s(5e3),W=s(23264),h=s(48112),R=s(28464),S=s(35676),N=s(74432),G=s(42816),z=s(42848),b=s(89616),u=s(20464),V=s(35480),Q=s(48744),q=s(32680),ss=s(89940),ts=s(71324),w=s(48636),Y=s(14632),es=s(49008),ns=s(17872),T=s(33104),as=s(29088),Ds=s(48632),cs=s(17892),Ms=s(31212),Os=s(60056),Ps=s(54320),Cs=s(5240),gs=s(91892),ms=s(36196),hs=s(20880),Rs=s(21424),us=s(54223),Ts=s(18424),Ls=s(97820),xs=s(99568),As=s(21968),vs=s(12132),Bs=s(85676),Is=s(35184),Us=s(96556);const os=()=>"todo empty role",Z=({id:a,name:c,description:o,usersCount:A,icons:d,rowIndex:p,canUpdate:M})=>{const{formatMessage:v}=(0,Y.c)(),[,B]=d,O=v({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:A});return(0,t.jsxs)(L.Tr,{"aria-rowindex":p,...M?(0,e.on)({fn:B.onClick}):{},children:[(0,t.jsx)(_.Td,{maxWidth:(0,e.W8)(130),children:(0,t.jsx)(i.O,{ellipsis:!0,textColor:"neutral800",children:c})}),(0,t.jsx)(_.Td,{maxWidth:(0,e.W8)(250),children:(0,t.jsx)(i.O,{ellipsis:!0,textColor:"neutral800",children:o})}),(0,t.jsx)(_.Td,{children:(0,t.jsx)(i.O,{textColor:"neutral800",children:O})}),(0,t.jsx)(_.Td,{children:(0,t.jsx)(x.C,{justifyContent:"flex-end",...e.Ii,children:d.map((P,I)=>P?(0,t.jsx)(r.k,{paddingLeft:I===0?0:1,children:(0,t.jsx)(W.w,{onClick:P.onClick,label:P.label,noBorder:!0,icon:P.icon})},P.label):null)})})]},a)};Z.propTypes={id:T.number.isRequired,name:T.string.isRequired,description:T.string.isRequired,usersCount:T.number.isRequired,icons:T.array.isRequired,rowIndex:T.number.isRequired,canUpdate:T.bool},Z.defaultProps={canUpdate:!1};const ls={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},_s=(a,c)=>(0,as.cp)(a,o=>{switch(c.type){case"ON_REMOVE_ROLES":{o.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{o.shouldRefetchData=!0,o.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{o.shouldRefetchData=!1,o.roleToDelete=null,o.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{o.roleToDelete=c.id;break}default:return o}}),is=({canCreate:a,canDelete:c,canUpdate:o,refetchRoles:A})=>{const{formatMessage:d}=(0,Y.c)(),{formatAPIError:p}=(0,e.An)(),M=(0,e.eo)(),[v,B]=(0,l.useState)(!1),{push:O}=(0,es.Uz)(),[{selectedRoles:P,showModalConfirmButtonLoading:I,roleToDelete:H},j]=(0,l.useReducer)(_s,ls),{post:J}=(0,e.YF)(),X=async()=>{try{j({type:"ON_REMOVE_ROLES"}),await J("/admin/roles/batch-delete",{ids:[H]}),await A(),j({type:"RESET_DATA_TO_DELETE"})}catch(n){M({type:"warning",message:p(n)})}U()},f=(0,l.useCallback)(n=>{O(`/settings/roles/duplicate/${n}`)},[O]),K=()=>O("/settings/roles/new"),y=(0,l.useCallback)(n=>{j({type:"SET_ROLE_TO_DELETE",id:n}),U()},[]),U=()=>B(n=>!n),C=(0,l.useCallback)(n=>{O(`/settings/roles/${n}`)},[O]),$=(0,l.useCallback)((n,m)=>{n.preventDefault(),n.stopPropagation(),m.usersCount?M({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):y(m.id)},[M,y]),k=(0,l.useCallback)((n,m)=>{n.preventDefault(),n.stopPropagation(),f(m.id)},[f]),Es=(0,l.useCallback)(n=>[...a?[{onClick:m=>k(m,n),label:d({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:(0,t.jsx)(q.c,{})}]:[],...o?[{onClick:()=>C(n.id),label:d({id:"app.utils.edit",defaultMessage:"Edit"}),icon:(0,t.jsx)(ss.c,{})}]:[],...c?[{onClick:m=>$(m,n),label:d({id:"global.delete",defaultMessage:"Delete"}),icon:(0,t.jsx)(ts.c,{})}]:[]],[d,$,k,C,a,o,c]);return{handleNewRoleClick:K,getIcons:Es,selectedRoles:P,isWarningDeleteAllOpened:v,showModalConfirmButtonLoading:I,handleToggleModal:U,handleDeleteData:X}},rs=()=>{const{formatMessage:a}=(0,Y.c)();(0,e.G0)();const c=(0,E.w1)(D.s),[{query:o}]=(0,e.WK)(),{isLoading:A,allowedActions:{canCreate:d,canDelete:p,canRead:M,canUpdate:v}}=(0,e.aU)(c.settings.roles),{roles:B,isLoading:O,refetch:P}=(0,ns.u)({filters:o?._q?{name:{$containsi:o._q}}:void 0},{cacheTime:0,enabled:!A&&M}),{handleNewRoleClick:I,getIcons:H,isWarningDeleteAllOpened:j,showModalConfirmButtonLoading:J,handleToggleModal:X,handleDeleteData:f}=is({refetchRoles:P,canCreate:d,canDelete:p,canUpdate:v}),K=B.length+1,y=6;if(A)return(0,t.jsx)(h.G,{children:(0,t.jsx)(e.Wm,{})});const U=a({id:"global.roles",defaultMessage:"roles"});return(0,t.jsxs)(h.G,{children:[(0,t.jsx)(e.K8,{name:"Roles"}),(0,t.jsx)(R.a,{primaryAction:d?(0,t.jsx)(S.Z,{onClick:I,startIcon:(0,t.jsx)(w.c,{}),size:"S",children:a({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,title:U,subtitle:a({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),M&&(0,t.jsx)(N.U,{startActions:(0,t.jsx)(e.w9,{label:a({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:U})})}),M&&(0,t.jsxs)(G.S,{children:[(0,t.jsxs)(z.o,{colCount:y,rowCount:K,footer:d?(0,t.jsx)(b.U,{onClick:I,icon:(0,t.jsx)(w.c,{}),children:a({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,children:[(0,t.jsx)(u.o,{children:(0,t.jsxs)(L.Tr,{"aria-rowindex":1,children:[(0,t.jsx)(_.Th,{children:(0,t.jsx)(i.O,{variant:"sigma",textColor:"neutral600",children:a({id:"global.name",defaultMessage:"Name"})})}),(0,t.jsx)(_.Th,{children:(0,t.jsx)(i.O,{variant:"sigma",textColor:"neutral600",children:a({id:"global.description",defaultMessage:"Description"})})}),(0,t.jsx)(_.Th,{children:(0,t.jsx)(i.O,{variant:"sigma",textColor:"neutral600",children:a({id:"global.users",defaultMessage:"Users"})})}),(0,t.jsx)(_.Th,{children:(0,t.jsx)(V.K,{children:a({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,t.jsx)(Q.K,{children:B?.map((C,$)=>(0,t.jsx)(Z,{id:C.id,name:C.name,description:C.description,usersCount:C.usersCount,icons:H(C),rowIndex:$+2,canUpdate:v},C.id))})]}),!K&&!O&&(0,t.jsx)(os,{})]}),(0,t.jsx)(e.cz,{isOpen:j,onConfirm:f,isConfirmButtonLoading:J,onToggleDialog:X})]})},ds=()=>{const a=(0,E.w1)(D.s);return(0,t.jsx)(e.rF,{permissions:a.settings.roles.main,children:(0,t.jsx)(rs,{})})}},17872:(F,g,s)=>{s.d(g,{u:()=>l});var t=s(62552),e=s(16048),E=s(14632),D=s(48632);const l=(L={},_={})=>{const{id:i="",...x}=L,{get:r}=(0,e.Qn)(),{locale:W}=(0,E.c)(),h=(0,e.In)(W,{sensitivity:"base"}),{data:R,error:S,isError:N,isLoading:G,refetch:z}=(0,D.useQuery)(["roles",i,x],async()=>{const{data:u}=await r(`/admin/roles/${i??""}`,{params:x});return u},_);return{roles:t.useMemo(()=>{let u=[];return R&&(Array.isArray(R.data)?u=R.data:u=[R.data]),[...u].sort((V,Q)=>h.compare(V.name,Q.name))},[R,h]),error:S,isError:N,isLoading:G,refetch:z}}},74432:(F,g,s)=>{s.d(g,{U:()=>E});var t=s(19968),e=s(48936);const E=({startActions:D,endActions:l})=>!D&&!l?null:(0,t.jsxs)(e.C,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,t.jsx)(e.C,{gap:2,wrap:"wrap",children:D}),(0,t.jsx)(e.C,{gap:2,shrink:0,wrap:"wrap",children:l})]})},89616:(F,g,s)=>{s.d(g,{U:()=>x});var t=s(19968),e=s(69372),E=s(5e3),D=s(6912),l=s(48936),L=s(63358);const _=(0,e.cp)(E.k)`
  height: ${24/16}rem;
  width: ${24/16}rem;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;

  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
  }

  svg path {
    fill: ${({theme:r})=>r.colors.primary600};
  }
`,i=(0,e.cp)(E.k)`
  border-radius: 0 0 ${({theme:r})=>r.borderRadius} ${({theme:r})=>r.borderRadius};
  display: block;
  width: 100%;
  border: none;
`,x=({children:r,icon:W,...h})=>(0,t.jsxs)("div",{children:[(0,t.jsx)(D.c,{}),(0,t.jsx)(i,{as:"button",background:"primary100",padding:5,...h,children:(0,t.jsxs)(l.C,{children:[(0,t.jsx)(_,{"aria-hidden":!0,background:"primary200",children:W}),(0,t.jsx)(E.k,{paddingLeft:3,children:(0,t.jsx)(L.O,{variant:"pi",fontWeight:"bold",textColor:"primary600",children:r})})]})})]})}}]);
