"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[4760],{34760:(H,T,t)=>{t.d(T,{E:()=>Ie,a:()=>w});var e=t(19968),_=t(62552),R=t(532),h=t(48936),U=t(33128),W=t(89296),K=t(93432),I=t(75872),b=t(45412),S=t(35480),m=t(63358),N=t(38296),Q=t(32568),V=t(19576),p=t(65092),he=t(9544),B=t(5e3),F=t(28724),D=t(70996),z=t(62492),_e=t(82800),pe=t(28464),te=t(35676),Ee=t(42816),me=t(48112),O=t(16048),L=t(48632),ne=t(49008),ae=t(50040),fe=t(48636),Me=t(24144),re=t(53305),oe=t(39716),Ce=t(64764),ve=t(37776),C=t(54223),i=t(33104),j=t(14632),ye=t(60056),ie=t(69372),P=t(97820);const xe=s=>s.reduce((n,a)=>{const r=a.split(".")[0];return n[r]||(n[r]=[]),n[r].push(a),n},{}),Oe=(0,ie.cp)(R.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,le=s=>{const n=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(n.push({id:"app.utils.publish",defaultMessage:"Publish"}),n.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),n},je=s=>{const n=["entry.create","entry.update","entry.delete"];return s&&n.push("entry.publish","entry.unpublish"),{entry:n,media:["media.create","media.update","media.delete"]}},Z=_.createContext(),de=({children:s})=>{const{formatMessage:n}=(0,j.c)(),{collectionTypes:a,isLoading:r}=(0,ae.u)(),l=_.useMemo(()=>a.some(o=>o.options.draftAndPublish===!0),[a]),g=n({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return(0,e.jsx)(Z.Provider,{value:{isDraftAndPublish:l},children:(0,e.jsxs)(h.C,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(U.u,{"aria-hidden":!0,children:g}),r&&(0,e.jsx)(W.c,{children:n({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})}),(0,e.jsx)(Oe,{"aria-label":g,children:s})]})})};de.propTypes={children:i.oneOfType([i.arrayOf(i.node),i.node]).isRequired};const G=({getHeaders:s=le})=>{const{isDraftAndPublish:n}=_.useContext(Z),{formatMessage:a}=(0,j.c)(),r=s(n);return(0,e.jsx)(K.Y,{children:(0,e.jsxs)(I._,{children:[(0,e.jsx)(b.d,{children:(0,e.jsx)(S.K,{children:a({id:"Settings.webhooks.event.select",defaultMessage:"Select event"})})}),r.map(l=>["app.utils.publish","app.utils.unpublish"].includes(l.id)?(0,e.jsx)(b.d,{title:a({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"}),children:(0,e.jsx)(m.O,{variant:"sigma",textColor:"neutral600",children:a(l)})},l.id):(0,e.jsx)(b.d,{children:(0,e.jsx)(m.O,{variant:"sigma",textColor:"neutral600",children:a(l)})},l.id))]})})};G.defaultProps={getHeaders:le},G.propTypes={getHeaders:i.func};const X=({providedEvents:s})=>{const{isDraftAndPublish:n}=_.useContext(Z),a=s||je(n),{values:r,handleChange:l}=(0,C.Sq)(),g="events",o=r.events,f=[],v=xe(o),u=({target:{name:c,value:d}})=>{let E=new Set(o);d?E.add(c):E.delete(c),l({target:{name:g,value:Array.from(E)}})},M=({target:{name:c,value:d}})=>{let E=new Set(o);d?a[c].forEach(y=>{f.includes(y)||E.add(y)}):a[c].forEach(y=>E.delete(y)),l({target:{name:g,value:Array.from(E)}})};return(0,e.jsx)(N.A,{children:Object.entries(a).map(([c,d])=>(0,e.jsx)(k,{disabledEvents:f,name:c,events:d,inputValue:v[c],handleSelect:u,handleSelectAll:M},c))})};X.defaultProps={providedEvents:null},X.propTypes={providedEvents:i.object};const Pe=s=>s.replace(/-/g," ").split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" "),k=({disabledEvents:s,name:n,events:a,inputValue:r,handleSelect:l,handleSelectAll:g})=>{const{formatMessage:o}=(0,j.c)(),f=a.filter(d=>!s.includes(d)),v=r.length>0,u=r.length===f.length,M=({target:{name:d}})=>{g({target:{name:d,value:!u}})},c=5;return(0,e.jsxs)(I._,{children:[(0,e.jsx)(b.w,{children:(0,e.jsx)(Q.y,{indeterminate:v&&!u,"aria-label":o({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:n,onChange:M,value:u,children:Pe(n)})}),a.map(d=>(0,e.jsx)(b.w,{children:(0,e.jsx)(V.c,{disabled:s.includes(d),"aria-label":d,name:d,value:r.includes(d),onValueChange:E=>l({target:{name:d,value:E}})})},d)),a.length<c&&(0,e.jsx)(b.w,{colSpan:c-a.length})]})};k.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},k.propTypes={disabledEvents:i.array,events:i.array,inputValue:i.array,handleSelect:i.func,handleSelectAll:i.func,name:i.string.isRequired};const w={Root:de,Headers:G,Body:X,EventRow:k};function be(){return(0,e.jsxs)(w.Root,{children:[(0,e.jsx)(w.Headers,{}),(0,e.jsx)(w.Body,{})]})}const ce=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],Y=({name:s,onChange:n,value:a,...r})=>{const{values:{headers:l}}=(0,C.Sq)(),[g,o]=(0,_.useState)(ce);(0,_.useEffect)(()=>{o(ce.filter(u=>!l?.some(M=>M.key!==a&&M.key===u)))},[l,a]);const f=u=>{n({target:{name:s,value:u}})},v=u=>{o(M=>[...M,u]),f(u)};return(0,e.jsx)(p.cT,{...r,onClear:()=>f(""),onChange:f,onCreateOption:v,placeholder:"",value:a,children:g.map(u=>(0,e.jsx)(he.m,{value:u,children:u},u))})};Y.defaultProps={value:void 0},Y.propTypes={name:i.string.isRequired,onChange:i.func.isRequired,value:i.string};const De=()=>{const{formatMessage:s}=(0,j.c)(),{values:n,errors:a}=(0,C.Sq)();return(0,e.jsxs)(h.C,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(U.u,{children:s({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})}),(0,e.jsx)(B.k,{padding:8,background:"neutral100",hasRadius:!0,children:(0,e.jsx)(C.KE,{validateOnChange:!1,name:"headers",render:({push:r,remove:l})=>(0,e.jsxs)(F.y,{gap:4,children:[n.headers.map((g,o)=>(0,e.jsxs)(_.Fragment,{children:[(0,e.jsx)(D.C,{col:6,children:(0,e.jsx)(C.IN,{as:Y,name:`headers.${o}.key`,"aria-label":`row ${o+1} key`,label:s({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:a.headers?.[o]?.key&&a.headers[o].key})}),(0,e.jsx)(D.C,{col:6,children:(0,e.jsxs)(h.C,{alignItems:"flex-end",children:[(0,e.jsx)(B.k,{style:{flex:1},children:(0,e.jsx)(C.IN,{as:z.g,name:`headers.${o}.value`,"aria-label":`row ${o+1} value`,label:s({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:a.headers?.[o]?.value&&a.headers[o].value})}),(0,e.jsx)(h.C,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:a.headers?.[o]?.value?0:5,children:(0,e.jsx)(O.CA,{disabled:n.headers.length===1,onClick:()=>l(o),label:s({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:o+1})})})]})})]},`${o}.${g.key}`)),(0,e.jsx)(D.C,{col:12,children:(0,e.jsx)(_e.c,{type:"button",onClick:()=>{r({key:"",value:""})},startIcon:(0,e.jsx)(fe.c,{}),children:s({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"})})})]})})})]})},$=ie.cp.svg(({theme:s,color:n})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${s.colors[n]};
  }
`),J=({isPending:s,statusCode:n})=>{const{formatMessage:a}=(0,j.c)();return s?(0,e.jsxs)(h.C,{gap:2,alignItems:"center",children:[(0,e.jsx)($,{as:Me.c}),(0,e.jsx)(m.O,{children:a({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"})})]}):n>=200&&n<300?(0,e.jsxs)(h.C,{gap:2,alignItems:"center",children:[(0,e.jsx)($,{as:re.c,color:"success700"}),(0,e.jsx)(m.O,{children:a({id:"Settings.webhooks.trigger.success",defaultMessage:"success"})})]}):n>=300?(0,e.jsxs)(h.C,{gap:2,alignItems:"center",children:[(0,e.jsx)($,{as:oe.c,color:"danger700"}),(0,e.jsxs)(m.O,{children:[a({id:"Settings.error",defaultMessage:"error"})," ",n]})]}):null};J.propTypes={isPending:i.bool.isRequired,statusCode:i.number},J.defaultProps={statusCode:void 0};const q=({statusCode:s,message:n})=>{const{formatMessage:a}=(0,j.c)();return s>=200&&s<300?(0,e.jsx)(h.C,{justifyContent:"flex-end",children:(0,e.jsx)(m.O,{textColor:"neutral600",ellipsis:!0,children:a({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"})})}):s>=300?(0,e.jsx)(h.C,{justifyContent:"flex-end",children:(0,e.jsx)(h.C,{maxWidth:(0,O.W8)(250),justifyContent:"flex-end",title:n,children:(0,e.jsx)(m.O,{ellipsis:!0,textColor:"neutral600",children:n})})}):null};q.propTypes={statusCode:i.number,message:i.string},q.defaultProps={statusCode:void 0,message:void 0};const ue=({onCancel:s})=>{const{formatMessage:n}=(0,j.c)();return(0,e.jsx)(h.C,{justifyContent:"flex-end",children:(0,e.jsx)("button",{onClick:s,type:"button",children:(0,e.jsxs)(h.C,{gap:2,alignItems:"center",children:[(0,e.jsx)(m.O,{textColor:"neutral400",children:n({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})}),(0,e.jsx)($,{as:oe.c,color:"neutral400"})]})})})};ue.propTypes={onCancel:i.func.isRequired};const ee=({isPending:s,onCancel:n,response:a})=>{const{statusCode:r,message:l}=a,{formatMessage:g}=(0,j.c)();return(0,e.jsx)(B.k,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(F.y,{gap:4,style:{alignItems:"center"},children:[(0,e.jsx)(D.C,{col:3,children:(0,e.jsx)(m.O,{children:g({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"})})}),(0,e.jsx)(D.C,{col:3,children:(0,e.jsx)(J,{isPending:s,statusCode:r})}),(0,e.jsx)(D.C,{col:6,children:s?(0,e.jsx)(ue,{onCancel:n}):(0,e.jsx)(q,{statusCode:r,message:l})})]})})};ee.defaultProps={isPending:!1,onCancel(){},response:{}},ee.propTypes={isPending:i.bool,onCancel:i.func,response:i.object};const Te=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ae=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Re=({formatMessage:s})=>P.kt().shape({name:P.Qb().required(s({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(Te,s({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:P.Qb().required(s({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ae,s({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:P.Wk(n=>{let a=P.M$();if(n.length===1){const{key:r,value:l}=n[0];if(!r&&!l)return a}return a.of(P.kt().shape({key:P.Qb().required(s({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:P.Qb().required(s({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:P.M$()}),se=({handleSubmit:s,triggerWebhook:n,isCreating:a,isTriggering:r,triggerResponse:l,data:g})=>{const{formatMessage:o}=(0,j.c)(),[f,v]=(0,_.useState)(!1),u=(0,ye.p)(be,async()=>(await t.e(7252).then(t.bind(t,79632))).EventTableEE),M=d=>Object.keys(d).length?Object.entries(d).map(([E,y])=>({key:E,value:y})):[{key:"",value:""}],c=(0,C.KO)({initialValues:{name:g?.name||"",url:g?.url||"",headers:M(g?.headers||{}),events:g?.events||[]},onSubmit(d,{resetForm:E,setSubmitting:y}){s(d),E({values:d}),y(!1)},validationSchema:Re({formatMessage:o}),validateOnChange:!1,validateOnBlur:!1});return u?(0,e.jsx)(C.uo,{value:c,children:(0,e.jsxs)(O.QF,{onSubmit:c.handleSubmit,children:[(0,e.jsx)(pe.a,{primaryAction:(0,e.jsxs)(h.C,{gap:2,children:[(0,e.jsx)(te.Z,{onClick:()=>{n(),v(!0)},variant:"tertiary",startIcon:(0,e.jsx)(Ce.c,{}),disabled:a||r,size:"L",children:o({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})}),(0,e.jsx)(te.Z,{startIcon:(0,e.jsx)(re.c,{}),type:"submit",size:"L",disabled:!c.dirty,loading:c.isSubmitting,children:o({id:"global.save",defaultMessage:"Save"})})]}),title:a?o({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):g?.name,navigationAction:(0,e.jsx)(O.cH,{startIcon:(0,e.jsx)(ve.c,{}),to:"/settings/webhooks",children:o({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(Ee.S,{children:(0,e.jsxs)(h.C,{direction:"column",alignItems:"stretch",gap:4,children:[f&&(0,e.jsx)(ee,{isPending:r,response:l,onCancel:()=>v(!1)}),(0,e.jsx)(B.k,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(h.C,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(F.y,{gap:6,children:[(0,e.jsx)(D.C,{col:6,children:(0,e.jsx)(C.IN,{as:z.g,name:"name",error:c?.errors?.name&&c.errors.name,label:o({id:"global.name",defaultMessage:"Name"}),required:!0})}),(0,e.jsx)(D.C,{col:12,children:(0,e.jsx)(C.IN,{as:z.g,name:"url",error:c?.errors?.url&&c.errors.url,label:o({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0})})]}),(0,e.jsx)(De,{}),(0,e.jsx)(u,{})]})})]})})]})}):null};se.propTypes={data:i.object,handleSubmit:i.func.isRequired,triggerWebhook:i.func.isRequired,isCreating:i.bool.isRequired,isTriggering:i.bool.isRequired,triggerResponse:i.object},se.defaultProps={data:void 0,triggerResponse:void 0};const ge=s=>({...s,headers:s.headers.reduce((n,{key:a,value:r})=>(a!==""&&(n[a]=r),n),{})}),Ie=()=>{const{params:{id:s}}=(0,ne.SU)("/settings/webhooks/:id"),n=s==="create",{replace:a}=(0,ne.Uz)(),r=(0,O.eo)(),{formatAPIError:l}=(0,O.An)(),g=(0,L.useQueryClient)(),{isLoading:o}=(0,ae.u)(),{put:f,get:v,post:u}=(0,O.Qn)(),{isLoading:M,data:c,error:d}=(0,L.useQuery)(["webhooks",s],async()=>{const{data:{data:x}}=await v(`/admin/webhooks/${s}`);return x},{enabled:!n});_.useEffect(()=>{d&&r({type:"warning",message:l(d)})},[d,r,l]);const{isLoading:E,data:y,isIdle:Se,mutate:Le}=(0,L.useMutation)(()=>u(`/admin/webhooks/${s}/trigger`)),Ue=()=>Le(null,{onError(x){r({type:"warning",message:l(x)})}}),We=(0,L.useMutation)(x=>u("/admin/webhooks",x)),Ke=(0,L.useMutation)(({id:x,body:A})=>f(`/admin/webhooks/${x}`,A)),Be=async x=>{if(n){We.mutate(ge(x),{onSuccess({data:A}){r({type:"success",message:{id:"Settings.webhooks.created"}}),a(`/settings/webhooks/${A.data.id}`)},onError(A){r({type:"warning",message:l(A)})}});return}Ke.mutate({id:s,body:ge(x)},{onSuccess(){g.invalidateQueries(["webhooks",s]),r({type:"success",message:{id:"notification.form.success.fields"}})},onError(A){r({type:"warning",message:l(A)})}})};return M||o?(0,e.jsx)(O.Wm,{}):(0,e.jsxs)(me.G,{children:[(0,e.jsx)(O.K8,{name:"Webhooks"}),(0,e.jsx)(se,{data:c,handleSubmit:Be,triggerWebhook:Ue,isCreating:n,isTriggering:E,isTriggerIdle:Se,triggerResponse:y?.data.data})]})}},50040:(H,T,t)=>{t.d(T,{u:()=>U});var e=t(62552),_=t(16048),R=t(78164),h=t(48632);function U(){const{get:W}=(0,_.Qn)(),{formatAPIError:K}=(0,_.An)(),I=(0,_.eo)(),b=(0,h.useQueries)([{queryKey:["content-manager","components"],async queryFn(){const{data:{data:p}}=await W("/content-manager/components");return p},onError(p){p instanceof R.Uh&&I({type:"warning",message:K(p)})}},{queryKey:["content-manager","content-types"],async queryFn(){const{data:{data:p}}=await W("/content-manager/content-types");return p},onError(p){p instanceof R.Uh&&I({type:"warning",message:K(p)})}}]),[S,m]=b,N=S.isLoading||m.isLoading,Q=e.useMemo(()=>(m?.data??[]).filter(p=>p.kind==="collectionType"&&p.isDisplayed),[m?.data]),V=e.useMemo(()=>(m?.data??[]).filter(p=>p.kind!=="collectionType"&&p.isDisplayed),[m?.data]);return{isLoading:N,components:e.useMemo(()=>S?.data??[],[S?.data]),collectionTypes:Q,singleTypes:V}}},9544:(H,T,t)=>{t.d(T,{m:()=>_});var e=t(65092);const _=e.cb},37776:(H,T,t)=>{t.d(T,{c:()=>R});var e=t(19968);const _=h=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...h,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),R=_}}]);
