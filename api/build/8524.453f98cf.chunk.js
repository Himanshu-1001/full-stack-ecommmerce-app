"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[8524],{68524:(J,p,s)=>{s.r(p),s.d(p,{default:()=>B});var e=s(19968),M=s(16048),h=s(70516),u=s(61952),I=s(29412),k=s(62552),T=s(48632),K=s(17892),S=s(31212),N=s(60056),U=s(54320),a=s(5240),F=s(91892),v=s(36196),Q=s(20880),V=s(21424),y=s(54223),G=s(18424),z=s(97820),O=s(99568),c=s(21968),n=s(12132),Y=s(85676),f=s(35184),A=s(96556),C=s(99620);const B=()=>{const W=(0,h.w1)(u.s);return(0,e.jsx)(M.rF,{permissions:W.settings["transfer-tokens"].create,children:(0,e.jsx)(I.T,{})})}},29412:(J,p,s)=>{s.d(p,{T:()=>Z});var e=s(19968),M=s(62552),h=s(5e3),u=s(48936),I=s(63358),k=s(28724),T=s(70996),K=s(48112),S=s(28464),N=s(35676),U=s(42816),a=s(16048),F=s(54223),v=s(14632),Q=s(48632),V=s(70516),y=s(49008),G=s(61952),z=s(71944),O=s(41268),c=s(99620),n=s(33104),Y=s(53305),f=s(97820);const A=({errors:_,onChange:d,canEditInputs:g,isCreating:o,values:E,transferToken:r})=>{const{formatMessage:m}=(0,v.c)(),x=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return(0,e.jsx)(h.k,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(u.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(I.O,{variant:"delta",as:"h2",children:m({id:"global.details",defaultMessage:"Details"})}),(0,e.jsxs)(k.y,{gap:5,children:[(0,e.jsx)(T.C,{col:6,xs:12,children:(0,e.jsx)(c.T,{errors:_,values:E,canEditInputs:g,onChange:d})},"name"),(0,e.jsx)(T.C,{col:6,xs:12,children:(0,e.jsx)(c.a,{errors:_,values:E,canEditInputs:g,onChange:d})},"description"),(0,e.jsx)(T.C,{col:6,xs:12,children:(0,e.jsx)(c.L,{isCreating:o,errors:_,values:E,onChange:d,token:r})},"lifespan"),(0,e.jsx)(T.C,{col:6,xs:12,children:(0,e.jsx)(c.b,{name:"permissions",values:E,errors:_,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:P=>{d({target:{name:"permissions",value:P}})},options:x,canEditInputs:g})},"permissions")]})]})})};A.propTypes={errors:n.shape({name:n.string,description:n.string,lifespan:n.string,type:n.string}),onChange:n.func.isRequired,canEditInputs:n.bool.isRequired,values:n.shape({name:n.string,description:n.string,lifespan:n.oneOfType([n.number,n.string]),type:n.string}).isRequired,isCreating:n.bool.isRequired,transferToken:n.shape({id:n.oneOfType([n.number,n.string]),type:n.string,lifespan:n.string,name:n.string,accessKey:n.string,permissions:n.array,description:n.string,createdAt:n.string})},A.defaultProps={errors:{},transferToken:{}};const C=({transferTokenName:_})=>{const{formatMessage:d}=(0,v.c)();return(0,a.G0)(),(0,e.jsxs)(K.G,{"aria-busy":"true",children:[(0,e.jsx)(a.K8,{name:"Transfer Tokens"}),(0,e.jsx)(S.a,{primaryAction:(0,e.jsx)(N.Z,{disabled:!0,startIcon:(0,e.jsx)(Y.c,{}),type:"button",size:"L",children:d({id:"global.save",defaultMessage:"Save"})}),title:_||d({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),(0,e.jsx)(U.S,{children:(0,e.jsx)(a.Wm,{})})]})};C.defaultProps={transferTokenName:null},C.propTypes={transferTokenName:n.string};const B=f.kt().shape({name:f.Qb(a.aO.string).max(100).required(a.aO.required),description:f.Qb().nullable(),lifespan:f.CQ().integer().min(0).nullable().defined(a.aO.required),permissions:f.Qb(a.aO.string).required(a.aO.required)}),W="Name already taken",Z=()=>{(0,a.G0)();const{formatMessage:_}=(0,v.c)(),{lockApp:d,unlockApp:g}=(0,a.H6)(),o=(0,a.eo)(),E=(0,y.Uz)(),[r,m]=(0,M.useState)(E.location.state?.transferToken.accessKey?{...E.location.state.transferToken}:null),{trackUsage:x}=(0,a.m4)(),P=(0,M.useRef)(x),{setCurrentStep:X}=(0,a.sg)(),b=(0,V.w1)(G.s),{allowedActions:{canCreate:w,canUpdate:q,canRegenerate:ss}}=(0,a.aU)(b.settings["transfer-tokens"]),{params:{id:R}}=(0,y.SU)("/settings/transfer-tokens/:id"),{get:es,post:ns,put:ts}=(0,a.Qn)(),i=R==="create",{formatAPIError:$}=(0,a.An)();(0,M.useEffect)(()=>{P.current(i?"didAddTokenFromList":"didEditTokenFromList",{tokenType:O.T})},[i]);const{status:as}=(0,Q.useQuery)(["transfer-token",R],async()=>{const{data:{data:t}}=await es(`/admin/transfer/tokens/${R}`);return m({...t}),t},{enabled:!i&&!r,onError(t){t.response.data.error.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:$(t)})}}),rs=async(t,D)=>{P.current(i?"willCreateToken":"willEditToken",{tokenType:O.T}),d();const j=t.lifespan&&parseInt(t.lifespan,10)&&t.lifespan!=="0"?parseInt(t.lifespan,10):null,L=t.permissions.split("-");try{const{data:{data:l}}=i?await ns("/admin/transfer/tokens",{...t,lifespan:j,permissions:L}):await ts(`/admin/transfer/tokens/${R}`,{name:t.name,description:t.description,permissions:L});g(),i&&(E.replace(`/settings/transfer-tokens/${l.id}`,{transferToken:l}),X("transferTokens.success")),m({...l}),o({type:"success",message:_(i?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),P.current(i?"didCreateToken":"didEditToken",{type:r?.permissions,tokenType:O.T})}catch(l){const os=(0,z.f)(l.response.data);D.setErrors(os),l?.response?.data?.error?.message===W?o({type:"warning",message:l.response.data.message||"notification.error.tokennamenotunique"}):l?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:l?.response?.data?.message||"notification.error"}),g()}},H=q&&!i||w&&i;if(!i&&!r&&as!=="success")return(0,e.jsx)(C,{transferTokenName:r?.name});const is=t=>{t?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:$(t)})};return(0,e.jsxs)(K.G,{children:[(0,e.jsx)(a.K8,{name:"Transfer Tokens"}),(0,e.jsx)(F.QJ,{validationSchema:B,validateOnChange:!1,initialValues:{name:r?.name||"",description:r?.description||"",lifespan:r?.lifespan?r.lifespan.toString():r?.lifespan,permissions:r?.permissions.join("-")},enableReinitialize:!0,onSubmit:(t,D)=>rs(t,D),children:({errors:t,handleChange:D,isSubmitting:j,values:L})=>(0,e.jsxs)(a.QF,{children:[(0,e.jsx)(c.F,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:r,setToken:m,canEditInputs:H,canRegenerate:ss,isSubmitting:j,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:is}),(0,e.jsx)(U.S,{children:(0,e.jsxs)(u.C,{direction:"column",alignItems:"stretch",gap:6,children:[Boolean(r?.name)&&(0,e.jsx)(c.c,{token:r?.accessKey,tokenType:O.T}),(0,e.jsx)(A,{errors:t,onChange:D,canEditInputs:H,isCreating:i,values:L,transferToken:r})]})})]})})]})}}}]);
