"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[3896],{8532:(w,c,s)=>{s.d(c,{a:()=>U,g:()=>D});var t=s(15520),a=s(48132);function D(E){if(!E)return null;const L=Object.entries(t.g.colors).filter(([,P])=>P.toUpperCase()===E.toUpperCase()).reduce((P,[K])=>(a.S?.[K]&&(P=K),P),null);return L?{themeColorName:L,name:a.S[L]}:null}function U(){return Object.entries(a.S).map(([E,f])=>({hex:t.g.colors[E].toUpperCase(),name:f}))}},41864:(w,c,s)=>{s.d(c,{A:()=>a,S:()=>t});const t="strapi_stage",a="strapi_assignee"},83896:(w,c,s)=>{s.r(c),s.d(c,{InformationBoxEE:()=>ss});var t=s(19968),a=s(16048),D=s(17899),U=s(95080),E=s(48936),f=s(65092),L=s(9544),P=s(56104),K=s(63358),z=s(89296),G=s(79080),H=s(74264),F=s(14632),x=s(48632),V=s(70516),ts=s(96556),as=s(85676),ns=s(21968),os=s(79371),es=s(80740),_s=s(36196),ls=s(35184),J=s(74253),X=s(61952),o=s(41864),S=s(62552),Z=s(34564),h=s(46276),u=s(48132),Q=s(8532),Es=s(87144),is=s(21424),rs=s(6841),ds=s(38955),Ms=s(12132),Os=s(13192),Ds=s(30840),Ps=s(60056),gs=s(54320),ms=s(5240),vs=s(91892),Cs=s(20880),cs=s(54223),hs=s(18424),As=s(97820),Is=s(99568),Ls=s(37132),Ws=s(67888),Ts=s(11700),Bs=s(52600),Rs=s(95752),Us=s(37388),fs=s(61840),Ks=s(49108),us=s(44632),ys=s(50840),js=s(20252),xs=s(86432),Ss=s(22612),Ns=s(24808),$s=s(24024),ps=s(33656),ws=s(81112),Fs=s(43280),Qs=s(79804),Ys=s(19632),zs=s(9589),Gs=s(45488),Hs=s(75516),Vs=s(44604),Js=s(42552),Xs=s(26220),Zs=s(30680),ks=s(29576),bs=s(61152),qs=s(17892),st=s(31212);function k(){const{initialData:_,layout:{uid:r},isSingleType:g,onChange:W}=(0,a.O_)(),T=(0,V.w1)(X.s),{formatMessage:n}=(0,F.c)(),{formatAPIError:B}=(0,a.An)(),M=(0,a.eo)(),{put:R}=(0,a.Qn)(),{allowedActions:{canReadUsers:d},isLoading:m}=(0,a.aU)({readUsers:T.settings.users.read}),{users:A,isLoading:I,isError:y}=(0,J.u)({},{enabled:!m&&d}),v=_?.[o.A]??null,C=async({value:e})=>{l.mutate({entityId:_.id,assigneeId:parseInt(e,10),uid:r})},l=(0,x.useMutation)(async({entityId:e,assigneeId:N,uid:$})=>{const i=g?"single-types":"collection-types",{data:{data:O}}=await R(`/admin/content-manager/${i}/${$}/${e}/assignee`,{data:{id:N}});return W({target:{name:o.A,value:O[o.A]}},!0),O},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.assignee.notification.saved",defaultMessage:"Assignee updated"}})}});return(0,t.jsx)(U.I,{name:o.A,id:o.A,children:(0,t.jsx)(E.C,{direction:"column",gap:2,alignItems:"stretch",children:(0,t.jsx)(f.k1,{clearLabel:n({id:"content-manager.reviewWorkflows.assignee.clear",defaultMessage:"Clear assignee"}),error:y&&d&&n({id:"content-manager.reviewWorkflows.assignee.error",defaultMessage:"An error occurred while fetching users"})||l.error&&B(l.error),disabled:!m&&!I&&A.length===0,name:o.A,id:o.A,value:v?v.id:null,onChange:e=>C({value:e}),onClear:()=>C({value:null}),placeholder:n({id:"content-manager.reviewWorkflows.assignee.placeholder",defaultMessage:"Select \u2026"}),label:n({id:"content-manager.reviewWorkflows.assignee.label",defaultMessage:"Assignee"}),loading:I||m||l.isLoading,children:A.map(e=>(0,t.jsx)(L.m,{value:e.id,textValue:(0,D.g)(e,n),children:(0,D.g)(e,n)},e.id))})})})}function b({id:_,layout:r}={},g={}){const{kind:W,uid:T}=r,n=W==="collectionType"?"collection-types":"single-types",{get:B}=(0,a.Qn)(),{data:M,isLoading:R,refetch:d}=(0,x.useQuery)(["content-manager",n,r.uid,_,"stages"],async()=>{const{data:I}=await B(`/admin/content-manager/${n}/${T}/${_}/stages`);return I},g),m=S.useMemo(()=>M?.meta??{},[M?.meta]),A=S.useMemo(()=>M?.data??[],[M?.data]);return{meta:m,stages:A,isLoading:R,refetch:d}}function q(){const{initialData:_,layout:r,isSingleType:g,onChange:W}=(0,a.O_)(),{put:T}=(0,a.Qn)(),{formatMessage:n}=(0,F.c)(),{formatAPIError:B}=(0,a.An)(),M=(0,a.eo)(),{meta:R,stages:d,isLoading:m,refetch:A}=b({id:_.id,layout:r},{enabled:!!_?.id}),{getFeature:I}=(0,Z.u)(),[y,v]=S.useState(!1),C=I("review-workflows"),l=_?.[o.S]??null,e=(0,x.useMutation)(async({entityId:i,stageId:O,uid:j})=>{const p=g?"single-types":"collection-types",{data:{data:Y}}=await T(`/admin/content-manager/${p}/${j}/${i}/stage`,{data:{id:O}});return W({target:{name:o.S,value:Y[o.S]}},!0),await A(),Y},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.stage.notification.saved",defaultMessage:"Review stage updated"}})}}),N=async({value:i})=>{try{C?.[u.C]&&parseInt(C[u.C],10)<R.workflowCount?v("workflow"):C?.[u.a]&&parseInt(C[u.a],10)<d.length?v("stage"):e.mutateAsync({entityId:_.id,stageId:i,uid:r.uid})}catch{}},{themeColorName:$}=l?.color?(0,Q.g)(l?.color):{};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.I,{hint:d.length===0&&n({id:"content-manager.reviewWorkflows.stages.no-transition",defaultMessage:"You don\u2019t have the permission to update this stage."}),name:o.S,id:o.S,children:(0,t.jsxs)(E.C,{direction:"column",gap:2,alignItems:"stretch",children:[(0,t.jsx)(P.K_,{disabled:d.length===0,error:e.error&&B(e.error)||null,name:o.S,id:o.S,value:l?.id,onChange:i=>N({value:i}),label:n({id:"content-manager.reviewWorkflows.stage.label",defaultMessage:"Review stage"}),startIcon:l&&(0,t.jsx)(E.C,{as:"span",height:2,background:l?.color,borderColor:$==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2,marginRight:"-3px"}),customizeContent:()=>(0,t.jsxs)(E.C,{as:"span",justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,t.jsx)(K.O,{textColor:"neutral800",ellipsis:!0,children:l?.name??""}),m?(0,t.jsx)(z.c,{small:!0,style:{display:"flex"},"data-testid":"loader"}):null]}),children:d.map(({id:i,color:O,name:j})=>{const{themeColorName:p}=(0,Q.g)(O);return(0,t.jsx)(P.kH,{startIcon:(0,t.jsx)(E.C,{height:2,background:O,borderColor:p==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2}),value:i,textValue:j,children:j},i)})}),(0,t.jsx)(G.o,{}),(0,t.jsx)(H.Q,{})]})}),(0,t.jsxs)(h.L,{isOpen:y==="workflow",onClose:()=>v(!1),children:[(0,t.jsx)(h.T,{children:n({id:"content-manager.reviewWorkflows.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,t.jsx)(h.B,{children:n({id:"content-manager.reviewWorkflows.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,t.jsxs)(h.L,{isOpen:y==="stage",onClose:()=>v(!1),children:[(0,t.jsx)(h.T,{children:n({id:"content-manager.reviewWorkflows.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,t.jsx)(h.B,{children:n({id:"content-manager.reviewWorkflows.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})}function ss(){const{isCreatingEntry:_,layout:{options:r}}=(0,a.O_)(),g=r?.reviewWorkflows??!1;return(0,t.jsxs)(D.I.Root,{children:[(0,t.jsx)(D.I.Title,{}),g&&!_&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(q,{}),(0,t.jsx)(k,{})]}),(0,t.jsx)(D.I.Body,{})]})}}}]);
